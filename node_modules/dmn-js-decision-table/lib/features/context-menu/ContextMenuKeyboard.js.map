{"version":3,"file":"ContextMenuKeyboard.js","names":["query","queryAll","classes","ContextMenuKeyboard","constructor","eventBus","on","addEventListeners","removeEventListeners","document","addEventListener","handleKeyEvent","handleMouseOver","removeEventListener","event","key","preventDefault","move","target","clickCurrentEntry","entries","getEntries","forEach","entry","resetHoverStyle","focused","getActiveEntries","remove","Array","from","filter","has","container","hover","current","menu","direction","next","add","index","indexOf","length","disableHoverStyle","style","removeProperty","click","$inject","element","setProperty"],"sources":["../../../src/features/context-menu/ContextMenuKeyboard.js"],"sourcesContent":["import { query, queryAll, classes } from 'min-dom';\n\n/**\n * Context menu keyboard navigation.\n */\nexport default class ContextMenuKeyboard {\n\n  constructor(eventBus) {\n    eventBus.on('contextMenu.open', () => this.addEventListeners());\n\n    eventBus.on('contextMenu.close', () => this.removeEventListeners());\n    eventBus.on('commandStack.executed', () => this.removeEventListeners());\n  }\n\n  addEventListeners = () => {\n    document.addEventListener('keydown', this.handleKeyEvent);\n    document.addEventListener('mouseover', this.handleMouseOver);\n  };\n\n  removeEventListeners = () => {\n    document.removeEventListener('keydown', this.handleKeyEvent);\n    document.removeEventListener('mouseover', this.handleMouseOver);\n  };\n\n  handleKeyEvent = (event) => {\n    if (event.key === 'ArrowUp') {\n      event.preventDefault();\n      this.move(event.target, -1);\n\n    } else if (event.key === 'ArrowDown') {\n      event.preventDefault();\n      this.move(event.target, 1);\n    }\n\n    else if (event.key === 'Enter') {\n      event.preventDefault();\n      this.clickCurrentEntry();\n    }\n  };\n\n  /**\n   * When mouse moves over the context menu, it takes over navigation from keyboard.\n   */\n  handleMouseOver = () => {\n    const entries = this.getEntries();\n    entries.forEach(entry => resetHoverStyle(entry));\n\n    const { focused } = this.getActiveEntries(document);\n    focused && classes(focused).remove('focused');\n  };\n\n  /**\n   * Get all context menu entries that aren't disabled.\n   * @returns {HTMLElement[]}\n   */\n  getEntries = () => {\n    return Array.from(\n      queryAll('.context-menu-group-entry')\n    ).filter(entry => !classes(entry).has('disabled'));\n  };\n\n  /**\n   * Get hovered with mouse, focused with keyboard\n   * and currently active context menu entries.\n   * @param {HTMLElement} container - Context menu container.\n   * @returns {Object}\n   */\n  getActiveEntries = (container) => {\n    const hover = query('.context-menu-group-entry:hover', container);\n    const focused = query('.context-menu-group-entry.focused', container);\n    const current = focused || hover;\n\n    return {\n      hover,\n      focused,\n      current\n    };\n  };\n\n  /**\n   * Move focus to the next or previous menu entry.\n   * @param {HTMLElement} menu - Context menu container.\n   * @param {Number} direction - 1 for moving down, -1 for moving up.\n   */\n  move = (menu, direction) => {\n    const entries = this.getEntries();\n    const { current, hover } = this.getActiveEntries(menu);\n\n    if (!current) {\n      const next = entries[0];\n      classes(next).add('focused');\n      return;\n    }\n\n    const index = entries.indexOf(current) + direction;\n    let next = entries[index];\n\n    if (index < 0) {\n      next = entries[entries.length - 1];\n    }\n\n    if (index >= entries.length) {\n      next = entries[0];\n    }\n\n    hover && disableHoverStyle(hover);\n    classes(current).remove('focused');\n    classes(next).add('focused');\n\n    // If mouse is currently over the entry that we are moving to...\n    next.style.removeProperty('background-color');\n  };\n\n  clickCurrentEntry = () => {\n    const { current } = this.getActiveEntries(document);\n    if (current) current.click();\n  };\n}\n\nContextMenuKeyboard.$inject = [ 'eventBus' ];\n\n\n// Helper functions\nfunction disableHoverStyle(element) {\n  element.style.setProperty('pointer-events', 'none');\n  element.style.setProperty('background-color', 'transparent');\n}\n\nfunction resetHoverStyle(element) {\n  element.style.removeProperty('background-color');\n  element.style.removeProperty('pointer-events');\n}"],"mappings":"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","ignoreList":[]}