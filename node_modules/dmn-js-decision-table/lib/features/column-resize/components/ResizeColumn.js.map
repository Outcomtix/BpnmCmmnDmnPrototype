{"version":3,"file":"ResizeColumn.js","names":["Component","inject","closest","domClosest","is","getBusinessObject","ResizeColumn","constructor","props","context","componentDidMount","root","getRoot","changeSupport","onElementsChanged","componentWillUnmount","offElementsChanged","sheet","forceUpdate","handleMouseDown","event","cell","target","startResize","node","minWidth","onEnd","saveWidth","newWidth","col","update","annotationsWidth","width","modeling","updateProperties","isLastInputOrOutput","bo","inputs","get","indexOf","length","outputs","render","style","right","createVNode","null","translate","$inject","noop","preventDefault","initialWidth","getBoundingClientRect","initialX","clientX","currentUpdate","document","addEventListener","handleMouseMove","handleMouseUp","currentWidth","getResizedWidth","cancelAnimationFrame","requestAnimationFrame","removeEventListener","currentX","delta","Math","max"],"sources":["../../../../src/features/column-resize/components/ResizeColumn.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { inject } from 'table-js/lib/components';\n\nimport {\n  closest as domClosest\n} from 'min-dom';\n\nimport { is, getBusinessObject } from 'dmn-js-shared/lib/util/ModelUtil';\n\n\nexport default class ResizeColumn extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    inject(this);\n  }\n\n  componentDidMount() {\n    const root = this.getRoot();\n\n    this.changeSupport.onElementsChanged(root, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const root = this.getRoot();\n\n    this.changeSupport.offElementsChanged(root, this.onElementsChanged);\n  }\n\n  getRoot() {\n    return this.sheet.getRoot();\n  }\n\n  onElementsChanged = () => {\n    this.forceUpdate();\n  };\n\n  handleMouseDown = event => {\n    const cell = domClosest(event.target, 'th', false);\n\n    startResize({\n      node: cell,\n      event,\n      minWidth: this.props.minWidth || 150,\n      onEnd: this.saveWidth\n    });\n  };\n\n  saveWidth = newWidth => {\n    const { col } = this.props;\n\n    const update = {};\n\n    if (is(col, 'dmn:DecisionTable')) {\n      update.annotationsWidth = newWidth;\n    } else {\n      update.width = newWidth;\n    }\n\n    this.modeling.updateProperties(col, update);\n  };\n\n  isLastInputOrOutput() {\n    const { col } = this.props,\n          root = this.getRoot(),\n          bo = getBusinessObject(root);\n\n    if (is(col, 'dmn:InputClause')) {\n      const inputs = bo.get('input');\n\n      return inputs.indexOf(col) === inputs.length - 1;\n    } else if (is(col, 'dmn:OutputClause')) {\n      const outputs = bo.get('output');\n\n      return outputs.indexOf(col) === outputs.length - 1;\n    }\n  }\n\n  render() {\n    const style = this.isLastInputOrOutput() ? {\n      right: '-7px',\n      width: '27px'\n    } : null;\n\n    return (\n      <div\n        onMouseDown={ this.handleMouseDown }\n        className=\"resize-column-handle\"\n        title={ this.translate('Resize') }\n        style={ style }\n      />\n    );\n  }\n}\n\nResizeColumn.$inject = [ 'sheet', 'changeSupport', 'translate', 'modeling' ];\n\n// helper\nfunction startResize({ node, event, minWidth, onEnd = noop }) {\n  event.preventDefault();\n\n  const initialWidth = node.getBoundingClientRect().width;\n  const initialX = event.clientX;\n\n  let currentUpdate;\n\n  document.addEventListener('mousemove', handleMouseMove);\n  document.addEventListener('mouseup', handleMouseUp);\n\n  function handleMouseMove(event) {\n    event.preventDefault();\n\n    const currentWidth = getResizedWidth(event.clientX);\n\n    if (currentUpdate) {\n      cancelAnimationFrame(currentUpdate);\n    }\n\n    currentUpdate = requestAnimationFrame(() => {\n      node.style.width = currentWidth + 'px';\n    });\n  }\n\n  function handleMouseUp(event) {\n    event.preventDefault();\n\n    document.removeEventListener('mousemove', handleMouseMove);\n    document.removeEventListener('mouseup', handleMouseUp);\n\n    const currentWidth = getResizedWidth(event.clientX);\n\n    onEnd(currentWidth);\n  }\n\n  function getResizedWidth(currentX) {\n    const delta = currentX - initialX;\n\n    return Math.max(initialWidth + delta, minWidth);\n  }\n}\n\nfunction noop() {}\n"],"mappings":";AAAA,SAASA,SAAS,QAAQ,SAAS;AAEnC,SAASC,MAAM,QAAQ,yBAAyB;AAEhD,SACEC,OAAO,IAAIC,UAAU,QAChB,SAAS;AAEhB,SAASC,EAAE,EAAEC,iBAAiB,QAAQ,kCAAkC;AAGxE,eAAe,MAAMC,YAAY,SAASN,SAAS,CAAC;EAElDO,WAAWA,CAACC,KAAK,EAAEC,OAAO,EAAE;IAC1B,KAAK,CAACD,KAAK,EAAEC,OAAO,CAAC;IAErBR,MAAM,CAAC,IAAI,CAAC;EACd;EAEAS,iBAAiBA,CAAA,EAAG;IAClB,MAAMC,IAAI,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;IAE3B,IAAI,CAACC,aAAa,CAACC,iBAAiB,CAACH,IAAI,EAAE,IAAI,CAACG,iBAAiB,CAAC;EACpE;EAEAC,oBAAoBA,CAAA,EAAG;IACrB,MAAMJ,IAAI,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;IAE3B,IAAI,CAACC,aAAa,CAACG,kBAAkB,CAACL,IAAI,EAAE,IAAI,CAACG,iBAAiB,CAAC;EACrE;EAEAF,OAAOA,CAAA,EAAG;IACR,OAAO,IAAI,CAACK,KAAK,CAACL,OAAO,CAAC,CAAC;EAC7B;EAEAE,iBAAiB,GAAGA,CAAA,KAAM;IACxB,IAAI,CAACI,WAAW,CAAC,CAAC;EACpB,CAAC;EAEDC,eAAe,GAAGC,KAAK,IAAI;IACzB,MAAMC,IAAI,GAAGlB,UAAU,CAACiB,KAAK,CAACE,MAAM,EAAE,IAAI,EAAE,KAAK,CAAC;IAElDC,WAAW,CAAC;MACVC,IAAI,EAAEH,IAAI;MACVD,KAAK;MACLK,QAAQ,EAAE,IAAI,CAACjB,KAAK,CAACiB,QAAQ,IAAI,GAAG;MACpCC,KAAK,EAAE,IAAI,CAACC;IACd,CAAC,CAAC;EACJ,CAAC;EAEDA,SAAS,GAAGC,QAAQ,IAAI;IACtB,MAAM;MAAEC;IAAI,CAAC,GAAG,IAAI,CAACrB,KAAK;IAE1B,MAAMsB,MAAM,GAAG,CAAC,CAAC;IAEjB,IAAI1B,EAAE,CAACyB,GAAG,EAAE,mBAAmB,CAAC,EAAE;MAChCC,MAAM,CAACC,gBAAgB,GAAGH,QAAQ;IACpC,CAAC,MAAM;MACLE,MAAM,CAACE,KAAK,GAAGJ,QAAQ;IACzB;IAEA,IAAI,CAACK,QAAQ,CAACC,gBAAgB,CAACL,GAAG,EAAEC,MAAM,CAAC;EAC7C,CAAC;EAEDK,mBAAmBA,CAAA,EAAG;IACpB,MAAM;QAAEN;MAAI,CAAC,GAAG,IAAI,CAACrB,KAAK;MACpBG,IAAI,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;MACrBwB,EAAE,GAAG/B,iBAAiB,CAACM,IAAI,CAAC;IAElC,IAAIP,EAAE,CAACyB,GAAG,EAAE,iBAAiB,CAAC,EAAE;MAC9B,MAAMQ,MAAM,GAAGD,EAAE,CAACE,GAAG,CAAC,OAAO,CAAC;MAE9B,OAAOD,MAAM,CAACE,OAAO,CAACV,GAAG,CAAC,KAAKQ,MAAM,CAACG,MAAM,GAAG,CAAC;IAClD,CAAC,MAAM,IAAIpC,EAAE,CAACyB,GAAG,EAAE,kBAAkB,CAAC,EAAE;MACtC,MAAMY,OAAO,GAAGL,EAAE,CAACE,GAAG,CAAC,QAAQ,CAAC;MAEhC,OAAOG,OAAO,CAACF,OAAO,CAACV,GAAG,CAAC,KAAKY,OAAO,CAACD,MAAM,GAAG,CAAC;IACpD;EACF;EAEAE,MAAMA,CAAA,EAAG;IACP,MAAMC,KAAK,GAAG,IAAI,CAACR,mBAAmB,CAAC,CAAC,GAAG;MACzCS,KAAK,EAAE,MAAM;MACbZ,KAAK,EAAE;IACT,CAAC,GAAG,IAAI;IAER,OAAAa,WAAA,WAGc,sBAAsB,EAAAC,IAAA;MAAA,eADlB,IAAI,CAAC3B,eAAe;MAAA,SAE1B,IAAI,CAAC4B,SAAS,CAAC,QAAQ,CAAC;MAAA,SACxBJ;IAAK;EAGnB;AACF;AAEArC,YAAY,CAAC0C,OAAO,GAAG,CAAE,OAAO,EAAE,eAAe,EAAE,WAAW,EAAE,UAAU,CAAE;;AAE5E;AACA,SAASzB,WAAWA,CAAC;EAAEC,IAAI;EAAEJ,KAAK;EAAEK,QAAQ;EAAEC,KAAK,GAAGuB;AAAK,CAAC,EAAE;EAC5D7B,KAAK,CAAC8B,cAAc,CAAC,CAAC;EAEtB,MAAMC,YAAY,GAAG3B,IAAI,CAAC4B,qBAAqB,CAAC,CAAC,CAACpB,KAAK;EACvD,MAAMqB,QAAQ,GAAGjC,KAAK,CAACkC,OAAO;EAE9B,IAAIC,aAAa;EAEjBC,QAAQ,CAACC,gBAAgB,CAAC,WAAW,EAAEC,eAAe,CAAC;EACvDF,QAAQ,CAACC,gBAAgB,CAAC,SAAS,EAAEE,aAAa,CAAC;EAEnD,SAASD,eAAeA,CAACtC,KAAK,EAAE;IAC9BA,KAAK,CAAC8B,cAAc,CAAC,CAAC;IAEtB,MAAMU,YAAY,GAAGC,eAAe,CAACzC,KAAK,CAACkC,OAAO,CAAC;IAEnD,IAAIC,aAAa,EAAE;MACjBO,oBAAoB,CAACP,aAAa,CAAC;IACrC;IAEAA,aAAa,GAAGQ,qBAAqB,CAAC,MAAM;MAC1CvC,IAAI,CAACmB,KAAK,CAACX,KAAK,GAAG4B,YAAY,GAAG,IAAI;IACxC,CAAC,CAAC;EACJ;EAEA,SAASD,aAAaA,CAACvC,KAAK,EAAE;IAC5BA,KAAK,CAAC8B,cAAc,CAAC,CAAC;IAEtBM,QAAQ,CAACQ,mBAAmB,CAAC,WAAW,EAAEN,eAAe,CAAC;IAC1DF,QAAQ,CAACQ,mBAAmB,CAAC,SAAS,EAAEL,aAAa,CAAC;IAEtD,MAAMC,YAAY,GAAGC,eAAe,CAACzC,KAAK,CAACkC,OAAO,CAAC;IAEnD5B,KAAK,CAACkC,YAAY,CAAC;EACrB;EAEA,SAASC,eAAeA,CAACI,QAAQ,EAAE;IACjC,MAAMC,KAAK,GAAGD,QAAQ,GAAGZ,QAAQ;IAEjC,OAAOc,IAAI,CAACC,GAAG,CAACjB,YAAY,GAAGe,KAAK,EAAEzC,QAAQ,CAAC;EACjD;AACF;AAEA,SAASwB,IAAIA,CAAA,EAAG,CAAC","ignoreList":[]}