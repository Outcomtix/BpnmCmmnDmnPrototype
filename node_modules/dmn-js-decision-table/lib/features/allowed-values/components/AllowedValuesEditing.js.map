{"version":3,"file":"AllowedValuesEditing.js","names":["Component","is","List","ValidatedInput","getValuesArray","parseString","AllowedValuesEditing","constructor","props","context","_translate","injector","get","_modeling","_changeSupport","changeSupport","target","getAllowedValuesTarget","parsedString","inputValues","text","outputValues","state","values","map","value","isCheckable","isRemovable","group","inputValue","onElementsChanged","forceUpdate","componentWillMount","id","componentWillUnmount","offElementsChanged","setPredefinedValues","setState","editAllowedValues","onListChange","element","getElement","$parent","onInput","isValid","onKeyDown","event","isEnter","keyCode","stopPropagation","preventDefault","concat","handleRemovePredifinedValuesClick","e","removePredefinedValues","output","input","inputExpression","render","typeRef","createVNode","isNull","length","createComponentVNode","Label","null","label"],"sources":["../../../../src/features/allowed-values/components/AllowedValuesEditing.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport List from 'dmn-js-shared/lib/components/List';\n\nimport ValidatedInput from 'dmn-js-shared/lib/components/ValidatedInput';\n\nimport {\n  getValuesArray,\n  parseString\n} from '../Utils';\n\n\nexport default class AllowedValuesEditing extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this._translate = context.injector.get('translate');\n\n    this._modeling = context.injector.get('modeling');\n    this._changeSupport = context.changeSupport;\n\n    const target = this.getAllowedValuesTarget();\n\n    const parsedString = parseString(\n      (target.inputValues && target.inputValues.text) ||\n      (target.outputValues && target.outputValues.text) ||\n      ''\n    );\n\n    if (parsedString) {\n      this.state = {\n        values: parsedString.values.map(value => {\n          return {\n            value,\n            isCheckable: false,\n            isRemovable: true,\n            group: this._translate('Predefined values')\n          };\n        }),\n        inputValue: ''\n      };\n    } else {\n      this.state = {\n        values: null,\n        inputValue: ''\n      };\n    }\n  }\n\n  onElementsChanged = () => {\n    this.forceUpdate();\n  };\n\n  componentWillMount() {\n    const target = this.getAllowedValuesTarget();\n\n    this._changeSupport.onElementsChanged(target.id, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const target = this.getAllowedValuesTarget();\n\n    this._changeSupport.offElementsChanged(target.id, this.onElementsChanged);\n  }\n\n  setPredefinedValues = (values) => {\n\n    // inputClause or outputClause\n    const target = this.getAllowedValuesTarget();\n\n    this.setState({\n      values\n    });\n\n    this._modeling.editAllowedValues(\n      target,\n      values && getValuesArray(values)\n    );\n  };\n\n  onListChange = (values) => {\n    this.setPredefinedValues(values);\n  };\n\n  getAllowedValuesTarget() {\n    const element = this.getElement();\n\n    if (is(element, 'dmn:LiteralExpression')) {\n      return element.$parent;\n    } else {\n      return element;\n    }\n  }\n\n  onInput = ({ isValid, value }) => {\n    this.setState({\n      inputValue: value\n    });\n  };\n\n  /**\n   * Add new value on ENTER.\n   */\n  onKeyDown = ({ isValid, event }) => {\n\n    if (!isEnter(event.keyCode)) {\n      return;\n    }\n\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (isValid) {\n      const {\n        inputValue,\n        values\n      } = this.state;\n\n      const parsedString = parseString(inputValue);\n\n      this.onListChange((values || []).concat(parsedString.values.map(value => {\n        return {\n          value,\n          isCheckable: false,\n          isRemovable: true,\n          group: this._translate('Predefined values')\n        };\n      })));\n\n      this.setState({\n        inputValue: ''\n      });\n\n    }\n  };\n\n  handleRemovePredifinedValuesClick = (e) => {\n    e.stopPropagation();\n\n    this.removePredefinedValues();\n  };\n\n  removePredefinedValues = () => {\n    this.setPredefinedValues(null);\n  };\n\n  getElement() {\n    return this.props.context.output || this.props.context.input.inputExpression;\n  }\n\n  render() {\n    const element = this.getElement();\n\n    const {\n      inputValue,\n      values\n    } = this.state;\n\n    return (\n      element.typeRef === 'string' ?\n        <div className=\"context-menu-container allowed-values-edit\">\n          <div className=\"dms-form-control\">\n            {\n              !isNull(values)\n              && values.length > 0\n              && <List\n                labelComponent={ Label }\n                items={ values }\n                onChange={ this.onListChange } />\n            }\n\n            {\n              !isNull(values)\n              && !values.length\n              && <div>\n                <label className=\"dms-label\">\n                  { this._translate('Predefined values') }\n                </label>\n                <span className=\"placeholder\">\n                  { this._translate('No values') }\n                </span>\n              </div>\n            }\n\n            {\n              !isNull(values)\n              && <p class=\"dms-hint\">\n                <button type=\"button\" className=\"del-values\"\n                  onClick={ this.handleRemovePredifinedValuesClick }>\n                  { this._translate('Clear predefined values') }\n                </button>\n              </p>\n            }\n\n            <label className=\"dms-label\">\n              { this._translate('Add predefined values') }\n            </label>\n\n            <ValidatedInput\n              onInput={ this.onInput }\n              onKeyDown={ this.onKeyDown }\n              placeholder={ this._translate('\"value\", \"value\", ...') }\n              type=\"text\"\n              validate={ value => {\n                if (!parseString(value)) {\n                  return this._translate('Strings must be in double quotes');\n                }\n              } }\n              value={ inputValue } />\n          </div>\n        </div>\n        : null\n    );\n  }\n}\n\nfunction Label(label) {\n  return <label className=\"dms-label\">{ label }</label>;\n}\n\n\n// helpers //////////////////////\n\nfunction isEnter(keyCode) {\n  return keyCode === 13;\n}\n\nfunction isNull(value) {\n  return value === null;\n}"],"mappings":"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","ignoreList":[]}