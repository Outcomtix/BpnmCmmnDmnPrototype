{"version":3,"file":"Description.js","names":["isString","isAny","getNodeById","DescriptionEditor","LOW_PRIORITY","LOWER_PRIORITY","OFFSET_X","Description","constructor","components","contextMenu","elementRegistry","eventBus","modeling","renderer","translate","_contextMenu","_modeling","_renderer","_translate","on","event","defaultPrevented","target","id","element","get","description","getDescription","preventDefault","container","getContainer","bounds","getBoundingClientRect","position","getPosition","open","contextMenuType","autoFocus","offset","x","y","onGetComponent","context","businessObject","existingDescription","className","onClick","removeDescription","addDescription","createVNode","cell","updateProperties","node","close","$inject","top","left","width","height","parentNode","scrollLeft","scrollTop"],"sources":["../../../src/features/description/Description.js"],"sourcesContent":["import { isString } from 'min-dash';\r\n\r\nimport { isAny } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nimport {\r\n  getNodeById\r\n} from '../cell-selection/CellSelectionUtil';\r\n\r\nimport DescriptionEditor from './components/DescriptionEditor';\r\n\r\nconst LOW_PRIORITY = 500;\r\n\r\nconst LOWER_PRIORITY = 750;\r\n\r\nconst OFFSET_X = 26;\r\n\r\n\r\nexport default class Description {\r\n\r\n  constructor(\r\n      components, contextMenu, elementRegistry,\r\n      eventBus, modeling, renderer, translate) {\r\n\r\n    this._contextMenu = contextMenu;\r\n    this._modeling = modeling;\r\n    this._renderer = renderer;\r\n    this._translate = translate;\r\n\r\n\r\n    eventBus.on('cell.click', LOWER_PRIORITY, (event) => {\r\n\r\n      if (event.defaultPrevented) {\r\n        return;\r\n      }\r\n\r\n      const {\r\n        target,\r\n        id\r\n      } = event;\r\n\r\n      const element = elementRegistry.get(id);\r\n\r\n      if (!isAny(element, [ 'dmn:UnaryTests', 'dmn:LiteralExpression' ])) {\r\n        return;\r\n      }\r\n\r\n      const description = getDescription(element);\r\n\r\n      if (!description) {\r\n\r\n        // prevent focus\r\n        event.preventDefault();\r\n      }\r\n\r\n      const container = renderer.getContainer(),\r\n            bounds = target.getBoundingClientRect();\r\n\r\n      const position = getPosition(container, bounds);\r\n\r\n      contextMenu.open(position, {\r\n        contextMenuType: 'cell-description',\r\n        autoFocus: false,\r\n        id,\r\n        offset: {\r\n          x: 4,\r\n          y: 4\r\n        }\r\n      });\r\n    });\r\n\r\n    components.onGetComponent('context-menu', (context = {}) => {\r\n      if (context.contextMenuType\r\n        && context.contextMenuType === 'cell-description') {\r\n\r\n        const element = elementRegistry.get(context.id);\r\n\r\n        const description = getDescription(element);\r\n\r\n        if (isString(description)) {\r\n          return DescriptionEditor;\r\n        }\r\n      }\r\n    });\r\n\r\n    components.onGetComponent('context-menu-cell-additional', LOW_PRIORITY,\r\n      (context = {}) => {\r\n        if (context.contextMenuType\r\n          && context.contextMenuType === 'context-menu') {\r\n\r\n          const { id } = context;\r\n\r\n          if (!id) {\r\n            return;\r\n          }\r\n\r\n          const element = elementRegistry.get(id);\r\n\r\n          // element might not be in element registry (e.g. cut)\r\n          if (!element) {\r\n            return;\r\n          }\r\n\r\n          const { businessObject } = element;\r\n\r\n          const { description } = businessObject;\r\n\r\n          const existingDescription = isString(description);\r\n\r\n          const className =\r\n            existingDescription\r\n              ? 'remove-description'\r\n              : 'add-description';\r\n\r\n          const onClick =\r\n            existingDescription\r\n              ? () => this.removeDescription(element)\r\n              : () => this.addDescription(element);\r\n\r\n          return (\r\n            <div\r\n              className={ `context-menu-group-entry ${ className }` }\r\n              onClick={ onClick }>\r\n              {\r\n                isString(description)\r\n                  ?\r\n                  this._translate('Remove cell description')\r\n                  :\r\n                  this._translate('Add cell description')\r\n              }\r\n            </div>\r\n          );\r\n        }\r\n      });\r\n  }\r\n\r\n  addDescription = (cell) => {\r\n    this._modeling.updateProperties(cell, {\r\n      description: ''\r\n    });\r\n\r\n    const container = this._renderer.getContainer();\r\n\r\n    const node = getNodeById(cell.id, container);\r\n\r\n    const bounds = node.getBoundingClientRect();\r\n\r\n    const position = getPosition(container, bounds);\r\n\r\n    this._contextMenu.open(position, {\r\n      contextMenuType: 'cell-description',\r\n      id: cell.id,\r\n      autoFocus: true,\r\n      offset: {\r\n        x: 4,\r\n        y: 4\r\n      }\r\n    });\r\n  };\r\n\r\n  removeDescription = (cell) => {\r\n    this._modeling.updateProperties(cell, {\r\n      description: null\r\n    });\r\n\r\n    this._contextMenu.close();\r\n  };\r\n}\r\n\r\nDescription.$inject = [\r\n  'components',\r\n  'contextMenu',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'modeling',\r\n  'renderer',\r\n  'translate'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction getPosition(container, bounds) {\r\n  const { top, left, width, height } = bounds;\r\n\r\n  return {\r\n    x: left + container.parentNode.scrollLeft - OFFSET_X,\r\n    y: top + container.parentNode.scrollTop,\r\n    width: width + (2 * OFFSET_X),\r\n    height\r\n  };\r\n}\r\n\r\nfunction getDescription(element) {\r\n  return element\r\n    && element.businessObject\r\n    && element.businessObject.description;\r\n}"],"mappings":"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","ignoreList":[]}