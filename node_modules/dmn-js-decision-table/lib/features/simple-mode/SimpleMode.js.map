{"version":3,"file":"SimpleMode.js","names":["SimpleModeButtonComponent","SimpleMode","constructor","components","contextMenu","elementRegistry","eventBus","renderer","_providers","onGetComponent","on","element","node","left","top","width","height","getBoundingClientRect","container","getContainer","open","x","parentNode","scrollLeft","y","scrollTop","contextMenuType","offset","e","event","id","isCmd","get","fire","preventDefault","registerProvider","provider","push","canSimpleEdit","reduce","$inject","altKey","ctrlKey","metaKey"],"sources":["../../../src/features/simple-mode/SimpleMode.js"],"sourcesContent":["import SimpleModeButtonComponent from './components/SimpleModeButtonComponent';\r\n\r\nexport default class SimpleMode {\r\n\r\n  constructor(components, contextMenu, elementRegistry, eventBus, renderer) {\r\n\r\n    this._providers = [];\r\n\r\n    components.onGetComponent('table.before', () => {\r\n      return SimpleModeButtonComponent;\r\n    });\r\n\r\n    eventBus.on('simpleMode.open', ({ element, node }) => {\r\n      const { left, top, width, height } = node.getBoundingClientRect();\r\n\r\n      const container = renderer.getContainer();\r\n\r\n      contextMenu.open({\r\n        x: left + container.parentNode.scrollLeft,\r\n        y: top + container.parentNode.scrollTop,\r\n        width,\r\n        height\r\n      }, {\r\n        contextMenuType: 'simple-mode-edit',\r\n        element,\r\n        offset: {\r\n          x: 4,\r\n          y: 4\r\n        }\r\n      });\r\n    });\r\n\r\n    eventBus.on('cell.click', e => {\r\n\r\n      const {\r\n        event,\r\n        node,\r\n        id\r\n      } = e;\r\n\r\n      if (isCmd(event)) {\r\n        const element = elementRegistry.get(id);\r\n\r\n        if (element) {\r\n          eventBus.fire('simpleMode.open', {\r\n            node,\r\n            element\r\n          });\r\n        }\r\n\r\n        // prevent focus\r\n        e.preventDefault();\r\n      }\r\n    });\r\n  }\r\n\r\n  registerProvider(provider) {\r\n    this._providers.push(provider);\r\n  }\r\n\r\n  canSimpleEdit(element) {\r\n    return this._providers.reduce((canSimpleEdit, provider) => {\r\n      return canSimpleEdit || provider(element);\r\n    }, false);\r\n  }\r\n}\r\n\r\nSimpleMode.$inject = [\r\n  'components',\r\n  'contextMenu',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'renderer'\r\n];\r\n\r\n\r\n// helpers //////////\r\n\r\nexport function isCmd(event) {\r\n\n  // ensure we don't react to AltGr\r\n  // (mapped to CTRL + ALT)\r\n  if (event.altKey) {\r\n    return false;\r\n  }\r\n\r\n  return event.ctrlKey || event.metaKey;\r\n}"],"mappings":"AAAA,OAAOA,yBAAyB,MAAM,wCAAwC;AAE9E,eAAe,MAAMC,UAAU,CAAC;EAE9BC,WAAWA,CAACC,UAAU,EAAEC,WAAW,EAAEC,eAAe,EAAEC,QAAQ,EAAEC,QAAQ,EAAE;IAExE,IAAI,CAACC,UAAU,GAAG,EAAE;IAEpBL,UAAU,CAACM,cAAc,CAAC,cAAc,EAAE,MAAM;MAC9C,OAAOT,yBAAyB;IAClC,CAAC,CAAC;IAEFM,QAAQ,CAACI,EAAE,CAAC,iBAAiB,EAAE,CAAC;MAAEC,OAAO;MAAEC;IAAK,CAAC,KAAK;MACpD,MAAM;QAAEC,IAAI;QAAEC,GAAG;QAAEC,KAAK;QAAEC;MAAO,CAAC,GAAGJ,IAAI,CAACK,qBAAqB,CAAC,CAAC;MAEjE,MAAMC,SAAS,GAAGX,QAAQ,CAACY,YAAY,CAAC,CAAC;MAEzCf,WAAW,CAACgB,IAAI,CAAC;QACfC,CAAC,EAAER,IAAI,GAAGK,SAAS,CAACI,UAAU,CAACC,UAAU;QACzCC,CAAC,EAAEV,GAAG,GAAGI,SAAS,CAACI,UAAU,CAACG,SAAS;QACvCV,KAAK;QACLC;MACF,CAAC,EAAE;QACDU,eAAe,EAAE,kBAAkB;QACnCf,OAAO;QACPgB,MAAM,EAAE;UACNN,CAAC,EAAE,CAAC;UACJG,CAAC,EAAE;QACL;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFlB,QAAQ,CAACI,EAAE,CAAC,YAAY,EAAEkB,CAAC,IAAI;MAE7B,MAAM;QACJC,KAAK;QACLjB,IAAI;QACJkB;MACF,CAAC,GAAGF,CAAC;MAEL,IAAIG,KAAK,CAACF,KAAK,CAAC,EAAE;QAChB,MAAMlB,OAAO,GAAGN,eAAe,CAAC2B,GAAG,CAACF,EAAE,CAAC;QAEvC,IAAInB,OAAO,EAAE;UACXL,QAAQ,CAAC2B,IAAI,CAAC,iBAAiB,EAAE;YAC/BrB,IAAI;YACJD;UACF,CAAC,CAAC;QACJ;;QAEA;QACAiB,CAAC,CAACM,cAAc,CAAC,CAAC;MACpB;IACF,CAAC,CAAC;EACJ;EAEAC,gBAAgBA,CAACC,QAAQ,EAAE;IACzB,IAAI,CAAC5B,UAAU,CAAC6B,IAAI,CAACD,QAAQ,CAAC;EAChC;EAEAE,aAAaA,CAAC3B,OAAO,EAAE;IACrB,OAAO,IAAI,CAACH,UAAU,CAAC+B,MAAM,CAAC,CAACD,aAAa,EAAEF,QAAQ,KAAK;MACzD,OAAOE,aAAa,IAAIF,QAAQ,CAACzB,OAAO,CAAC;IAC3C,CAAC,EAAE,KAAK,CAAC;EACX;AACF;AAEAV,UAAU,CAACuC,OAAO,GAAG,CACnB,YAAY,EACZ,aAAa,EACb,iBAAiB,EACjB,UAAU,EACV,UAAU,CACX;;AAGD;;AAEA,OAAO,SAAST,KAAKA,CAACF,KAAK,EAAE;EAE3B;EACA;EACA,IAAIA,KAAK,CAACY,MAAM,EAAE;IAChB,OAAO,KAAK;EACd;EAEA,OAAOZ,KAAK,CAACa,OAAO,IAAIb,KAAK,CAACc,OAAO;AACvC","ignoreList":[]}