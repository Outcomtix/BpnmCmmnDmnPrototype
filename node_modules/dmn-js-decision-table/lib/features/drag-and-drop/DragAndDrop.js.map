{"version":3,"file":"DragAndDrop.js","names":["classes","domClasses","domify","queryAll","domQueryAll","remove","domRemove","isInput","isOutput","Row","Col","forEach","TOP","RIGHT","BOTTOM","LEFT","DragAndDrop","constructor","components","elementRegistry","eventBus","dragAndDrop","renderer","rules","sheet","translate","_elementRegistry","_dragAndDrop","_renderer","_rules","_sheet","_translate","onGetComponent","cellType","col","row","createVNode","createTextVNode","e","startDrag","title","null","on","event","dragContext","draggedElement","hoverEl","dropIndex","getTargetColIndex","allowed","index","targetEl","container","getContainer","removeHighlight","originalEvent","lastPosition","newPosition","getVerticalPosition","getHorizontalPosition","highlightRow","highlightCol","verticalPosition","rowId","dataset","get","targetRow","getTargetRow","getRoot","rows","horizontalPosition","colId","targetCol","getTargetCol","cols","_cleanup","element","_dragImage","document","body","appendChild","dataTransfer","setDragImage","fadeOutRow","fadeOutCol","removeFadeOut","$inject","cellEl","indexOf","dragOverCell","position","cells","cell","isNode","add","id","dragOverElement","bounds","getBoundingClientRect","clientX","left","width","clientY","top","height","draggedRow","getRowBelow","getRowAbove","draggedCol","getColRight","getColLeft","Math","max","min","length","firstOutput","filter","firstOutputIndex","inputs","lastInput","lastInputIndex","node","nodeType"],"sources":["../../../src/features/drag-and-drop/DragAndDrop.js"],"sourcesContent":["import {\r\n  classes as domClasses,\r\n  domify,\r\n  queryAll as domQueryAll,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport { isInput, isOutput } from 'dmn-js-shared/lib/util/ModelUtil';\r\n\r\nimport { Row, Col } from 'table-js/lib/model';\r\n\r\nimport { forEach } from 'min-dash';\r\n\r\nconst TOP = 'top',\r\n      RIGHT = 'right',\r\n      BOTTOM = 'bottom',\r\n      LEFT = 'left';\r\n\r\n\r\nexport default class DragAndDrop {\r\n\r\n  constructor(\r\n      components, elementRegistry, eventBus,\r\n      dragAndDrop, renderer, rules, sheet, translate) {\r\n\r\n    this._elementRegistry = elementRegistry;\r\n    this._dragAndDrop = dragAndDrop;\r\n    this._renderer = renderer;\r\n    this._rules = rules;\r\n    this._sheet = sheet;\r\n    this._translate = translate;\r\n\r\n    // provide drag handle for drag and drop\r\n    components.onGetComponent('cell-inner', ({ cellType, col, row }) => {\r\n      if (cellType === 'rule-index') {\r\n        return () => <span\r\n          draggable=\"true\"\r\n          onDragStart={ e => this.startDrag(row, e) }\r\n          className=\"dmn-icon-drag vertical\"\r\n          title={ this._translate('Move rule') }>&nbsp;</span>;\r\n      } else if (cellType === 'input-cell' || cellType === 'output-cell') {\r\n\r\n        let title = `Move ${isInput(col) ? 'Input' : 'Output' }`;\r\n\r\n        return () => <span\r\n          draggable=\"true\"\r\n          onDragStart={ e => this.startDrag(col, e) }\r\n          className=\"dmn-icon-drag horizontal\"\r\n          title={ title }></span>;\r\n      }\r\n    });\r\n\r\n    // validate allowed rules\r\n    eventBus.on('dragAndDrop.dragEnter', (event) => {\r\n\r\n      const {\r\n        dragContext\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        hoverEl\r\n      } = dragContext;\r\n\r\n      // can always drag rows\r\n      if (draggedElement instanceof Row) {\r\n        return true;\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        const dropIndex = getTargetColIndex(hoverEl, this._elementRegistry, this._sheet);\r\n\r\n        // cannot drop as we cannot compute the drop index\r\n        if (dropIndex === -1) {\r\n          return false;\r\n        }\r\n\r\n        const allowed = this._rules.allowed('col.move', {\r\n          col: draggedElement,\r\n          index: dropIndex\r\n        });\r\n\r\n        return allowed;\r\n      }\r\n\r\n      return false;\r\n    });\r\n\r\n    // clear previous UI\r\n    eventBus.on('dragAndDrop.dragLeave', (event) => {\r\n\r\n      const {\r\n        dragContext\r\n      } = event;\r\n\r\n      const {\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      if (!targetEl) {\r\n        return;\r\n      }\r\n\r\n      const container = this._renderer.getContainer();\r\n\r\n      removeHighlight(container);\r\n    });\r\n\r\n    // update UI\r\n    eventBus.on('dragAndDrop.dragOver', (event) => {\r\n\r\n      const {\r\n        dragContext,\r\n        originalEvent\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        lastPosition,\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      const container = this._renderer.getContainer();\r\n\r\n      if (!targetEl) {\r\n        return false;\r\n      }\r\n\r\n      let newPosition;\r\n\r\n      if (draggedElement instanceof Row) {\r\n        newPosition = getVerticalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        newPosition = getHorizontalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n      }\r\n\r\n      // nothing to do\r\n      if (lastPosition === newPosition) {\r\n        return true;\r\n      }\r\n\r\n      // remove old highlight\r\n      removeHighlight(container);\r\n\r\n      if (draggedElement instanceof Row) {\r\n\r\n        if (newPosition === TOP) {\r\n\r\n          // drop above\r\n          highlightRow(targetEl, container, 'top');\r\n        } else {\r\n\r\n          // drop below\r\n          highlightRow(targetEl, container, 'bottom');\r\n        }\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        if (newPosition === LEFT) {\r\n\r\n          // drop left\r\n          highlightCol(targetEl, container, 'left');\r\n        } else {\r\n\r\n          // drop right\r\n          highlightCol(targetEl, container, 'right');\r\n        }\r\n      }\r\n\r\n      // remember position\r\n      dragContext.lastPosition = newPosition;\r\n\r\n      // allowed\r\n      return true;\r\n    });\r\n\r\n\r\n    // perform drop operation\r\n    eventBus.on('dragAndDrop.drop', (event) => {\r\n\r\n      const {\r\n        dragContext,\r\n        originalEvent\r\n      } = event;\r\n\r\n      const {\r\n        draggedElement,\r\n        targetEl\r\n      } = dragContext;\r\n\r\n      if (!targetEl) {\r\n        return false;\r\n      }\r\n\r\n      if (draggedElement instanceof Row) {\r\n        const verticalPosition = getVerticalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n\r\n        const rowId = targetEl.dataset.rowId,\r\n              row = this._elementRegistry.get(rowId);\r\n\r\n        if (!row || row === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        const targetRow = getTargetRow(\r\n          draggedElement,\r\n          row,\r\n          verticalPosition,\r\n          this._sheet.getRoot().rows\r\n        );\r\n\r\n        if (targetRow === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        return targetRow;\r\n      }\r\n\r\n      if (draggedElement instanceof Col) {\r\n        const horizontalPosition = getHorizontalPosition(\r\n          originalEvent,\r\n          targetEl\r\n        );\r\n\r\n        // no need to check rules; we verified on\r\n        // dragEnter that dropping is O.K.\r\n        const colId = targetEl.dataset.colId,\r\n              col = this._elementRegistry.get(colId);\r\n\r\n        if (!col || col === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        const targetCol = getTargetCol(\r\n          draggedElement,\r\n          col,\r\n          horizontalPosition,\r\n          this._sheet.getRoot().cols\r\n        );\r\n\r\n        if (targetCol === draggedElement) {\r\n          return;\r\n        }\r\n\r\n        return targetCol;\r\n      }\r\n    });\r\n\r\n    eventBus.on('dragAndDrop.dragEnd', this._cleanup);\r\n  }\r\n\r\n  startDrag(element, event) {\r\n    const container = this._renderer.getContainer();\r\n\r\n    this._dragImage = domify(\r\n      `<span style=\"\r\n          visibility: hidden;\r\n          position: fixed;\r\n          top: -10000px\r\n      \"></span>`\r\n    );\r\n\r\n    // needs to be present in DOM\r\n    document.body.appendChild(this._dragImage);\r\n\r\n    // QUIRK: not supported by Edge and Internet Explorer\r\n    if (event.dataTransfer.setDragImage) {\r\n      event.dataTransfer.setDragImage(this._dragImage, 0, 0);\r\n    }\r\n\r\n    if (element instanceof Row) {\r\n      fadeOutRow(element, container);\r\n    } else if (element instanceof Col) {\r\n      fadeOutCol(element, container);\r\n    }\r\n\r\n    this._dragAndDrop.startDrag(element, event);\r\n  }\r\n\r\n  _cleanup = () => {\r\n    const container = this._renderer.getContainer();\r\n\r\n    removeHighlight(container);\r\n    removeFadeOut(container);\r\n\r\n    if (this._dragImage) {\r\n      domRemove(this._dragImage);\r\n\r\n      this._dragImage = null;\r\n    }\r\n  };\r\n\r\n}\r\n\r\nDragAndDrop.$inject = [\r\n  'components',\r\n  'elementRegistry',\r\n  'eventBus',\r\n  'dragAndDrop',\r\n  'renderer',\r\n  'rules',\r\n  'sheet',\r\n  'translate'\r\n];\r\n\r\n// helpers //////////\r\n\r\nfunction getTargetColIndex(cellEl, elementRegistry, sheet) {\r\n  const targetCol = elementRegistry.get(cellEl.dataset.colId);\r\n\r\n  if (!targetCol) {\r\n    return -1;\r\n  }\r\n\r\n  const { cols } = sheet.getRoot();\r\n\r\n  return cols.indexOf(targetCol);\r\n}\r\n\r\nfunction highlightRow(dragOverCell, container, position) {\r\n  const rowId = dragOverCell.dataset.rowId;\r\n\r\n  if (!rowId) {\r\n    return;\r\n  }\r\n\r\n  const cells = domQueryAll(`[data-row-id=${rowId}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragover');\r\n      domClasses(cell).add(position);\r\n    }\r\n  });\r\n}\r\n\r\nfunction highlightCol(dragOverCell, container, position) {\r\n  const colId = dragOverCell.dataset.colId;\r\n\r\n  if (!colId) {\r\n    return;\r\n  }\r\n\r\n  const cells = domQueryAll(`[data-col-id=${colId}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragover');\r\n      domClasses(cell).add(position);\r\n    }\r\n  });\r\n}\r\n\r\nfunction removeHighlight(container) {\r\n  const cells = domQueryAll('.dragover', container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).remove('dragover');\r\n      domClasses(cell).remove('top');\r\n      domClasses(cell).remove('right');\r\n      domClasses(cell).remove('bottom');\r\n      domClasses(cell).remove('left');\r\n    }\r\n  });\r\n}\r\n\r\nfunction fadeOutRow(row, container) {\r\n  const cells = domQueryAll(`[data-row-id=${row.id}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction fadeOutCol(col, container) {\r\n  const cells = domQueryAll(`[data-col-id=${col.id}]`, container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).add('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction removeFadeOut(container) {\r\n  const cells = domQueryAll('.dragged', container);\r\n\r\n  forEach(cells, cell => {\r\n\r\n    // QUIRK: PhantomJS might return object instead of NodeList\r\n    if (isNode(cell)) {\r\n      domClasses(cell).remove('dragged');\r\n    }\r\n  });\r\n}\r\n\r\nfunction getHorizontalPosition(event, dragOverElement) {\r\n  const bounds = dragOverElement.getBoundingClientRect();\r\n\r\n  return event.clientX < (bounds.left + bounds.width / 2)\r\n    ? LEFT\r\n    : RIGHT;\r\n}\r\n\r\nfunction getVerticalPosition(event, dragOverElement) {\r\n  const bounds = dragOverElement.getBoundingClientRect();\r\n\r\n  return event.clientY < (bounds.top + bounds.height / 2)\r\n    ? TOP\r\n    : BOTTOM;\r\n}\r\n\r\nfunction getTargetRow(draggedRow, targetRow, verticalPosition, rows) {\r\n  if (rows.indexOf(draggedRow) > rows.indexOf(targetRow)) {\r\n    targetRow = getRowBelow(targetRow, rows);\r\n  }\r\n\r\n  if (verticalPosition === TOP) {\r\n\r\n    // return row above or row\r\n    return getRowAbove(targetRow, rows);\r\n  } else {\r\n\r\n    // return row\r\n    return targetRow;\r\n  }\r\n}\r\n\r\nfunction getTargetCol(draggedCol, targetCol, horizontalPosition, cols) {\r\n  if (cols.indexOf(draggedCol) > cols.indexOf(targetCol)) {\r\n    targetCol = getColRight(targetCol, cols);\r\n  }\r\n\r\n  if (horizontalPosition === LEFT) {\r\n\r\n    // return col left or col\r\n    return getColLeft(targetCol, cols);\r\n  } else {\r\n\r\n    // return col\r\n    return targetCol;\r\n  }\r\n}\r\n\r\nfunction getRowAbove(row, rows) {\r\n  const index = rows.indexOf(row);\r\n\r\n  return rows[ Math.max(0, index - 1) ];\r\n}\r\n\r\nfunction getRowBelow(row, rows) {\r\n  const index = rows.indexOf(row);\r\n\r\n  return rows[ Math.min(rows.length - 1, index + 1) ];\r\n}\r\n\r\nfunction getColLeft(col, cols) {\r\n  const index = cols.indexOf(col);\r\n\r\n  if (isOutput(col)) {\r\n    const firstOutput = cols.filter(col => isOutput(col))[0];\r\n\r\n    const firstOutputIndex = cols.indexOf(firstOutput);\r\n\r\n    return cols[ Math.max(firstOutputIndex, index - 1) ];\r\n  }\r\n\r\n  return cols[ Math.max(0, index - 1) ];\r\n}\r\n\r\nfunction getColRight(col, cols) {\r\n  const index = cols.indexOf(col);\r\n\r\n  if (isInput(col)) {\r\n    const inputs = cols.filter(col => isInput(col));\r\n\r\n    const lastInput = inputs[ inputs.length - 1 ];\r\n\r\n    const lastInputIndex = cols.indexOf(lastInput);\r\n\r\n    return cols[ Math.min(lastInputIndex, index + 1) ];\r\n  }\r\n\r\n  return cols[ Math.min(cols.length - 1, index + 1) ];\r\n}\r\n\r\n// QUIRK: PhantomJS requires check if actual DOM node\r\nfunction isNode(node) {\r\n  return node && (node.nodeType === 1 || node.nodeType == 11);\r\n}"],"mappings":"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","ignoreList":[]}