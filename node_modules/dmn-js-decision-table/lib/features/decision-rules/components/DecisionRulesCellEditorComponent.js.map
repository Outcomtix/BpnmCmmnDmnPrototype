{"version":3,"file":"DecisionRulesCellEditorComponent.js","names":["Component","isString","is","ContentEditable","LiteralExpression","Cell","DecisionRulesCellEditorComponent","constructor","props","context","changeCellValue","bind","onElementsChanged","forceUpdate","componentWillMount","injector","cell","changeSupport","_changeSupport","_modeling","get","id","componentWillUnmount","offElementsChanged","value","editCell","businessObject","render","rowIndex","row","col","colIndex","isUnaryTest","createComponentVNode","children","TableCellEditor","text","FeelEditor","state","focussed","onFocus","onBlur","setState","className","createVNode","normalizeProps","onInput","_expressionLanguages","_translate","_variableResolver","isDefaultExpressionLanguage","expressionLanguage","defaultExpressionLanguage","getDefaultExpressionLanguage","getDescription","description","getExpressionLanguageLabel","getLabel","label","isScript","_isInputCell","indexOf","elementType","getDefault","getEditor","isFEEL","getExpressionLanguage","_getVariables","getVariables","_getLabel","placeholder","onChange","expressionLanguageLabel","Editor","variables"],"sources":["../../../../src/features/decision-rules/components/DecisionRulesCellEditorComponent.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport { isString } from 'min-dash';\n\nimport { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport ContentEditable from 'dmn-js-shared/lib/components/ContentEditable';\nimport LiteralExpression from 'dmn-js-shared/lib/components/LiteralExpression';\n\nimport { Cell } from 'table-js/lib/components';\n\n\nexport default class DecisionRulesCellEditorComponent extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.changeCellValue = this.changeCellValue.bind(this);\n    this.onElementsChanged = this.onElementsChanged.bind(this);\n  }\n\n  onElementsChanged() {\n    this.forceUpdate();\n  }\n\n  componentWillMount() {\n    const { injector } = this.context;\n\n    const { cell } = this.props;\n\n    const changeSupport = this._changeSupport = this.context.changeSupport;\n\n    this._modeling = injector.get('modeling');\n\n    changeSupport.onElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n  componentWillUnmount() {\n    const { cell } = this.props;\n\n    this._changeSupport.offElementsChanged(cell.id, this.onElementsChanged);\n  }\n\n  changeCellValue(value) {\n    const { cell } = this.props;\n\n    this._modeling.editCell(cell.businessObject, value);\n  }\n\n  render() {\n    const {\n      cell,\n      rowIndex,\n      row,\n      col,\n      colIndex\n    } = this.props;\n\n    const isUnaryTest = is(cell, 'dmn:UnaryTests');\n    const businessObject = cell.businessObject;\n\n    return (\n      <Cell\n        className={ isUnaryTest ? 'input-cell' : 'output-cell' }\n        elementId={ cell.id }\n        coords={ `${rowIndex}:${colIndex}` }\n        data-row-id={ row.id }\n        data-col-id={ col.id }\n      >\n        <TableCellEditor\n          placeholder={ isUnaryTest ? '-' : '' }\n          onChange={ this.changeCellValue }\n          value={ businessObject.text }\n          businessObject={ businessObject } />\n      </Cell>\n    );\n  }\n}\n\nclass FeelEditor extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.state = { focussed: false };\n\n    this.onFocus = this.onFocus.bind(this);\n    this.onBlur = this.onBlur.bind(this);\n  }\n\n  onFocus() {\n    this.setState({ focussed: true });\n  }\n\n  onBlur() {\n    this.setState({ focussed: false });\n  }\n\n  render() {\n    const { focussed } = this.state;\n    const className = `feel-editor${focussed ? ' focussed' : ''}`;\n\n    // TODO(@barmac): display only a single editor;\n    // required to workaround \"replaceChild\" error\n    return <div className={ className } onClick={ this.onFocus }>\n      { focussed &&\n        <LiteralExpression\n          { ...this.props }\n          autoFocus={ true }\n          onBlur={ this.onBlur }\n        />\n      }\n      <ContentEditable\n        { ...this.props }\n        onInput={ () => {} }\n        onFocus={ this.onFocus }\n      />\n    </div>;\n  }\n}\n\nclass TableCellEditor extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    this._expressionLanguages = context.injector.get('expressionLanguages');\n    this._translate = context.injector.get('translate');\n    this._variableResolver = context.injector.get('variableResolver', false);\n  }\n\n  isDefaultExpressionLanguage(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage().value;\n\n    return !expressionLanguage || expressionLanguage === defaultExpressionLanguage;\n  }\n\n  getDescription(businessObject) {\n    return businessObject.description;\n  }\n\n  getExpressionLanguageLabel(businessObject) {\n    const { expressionLanguage } = businessObject;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage();\n\n    return this._expressionLanguages.getLabel(expressionLanguage) ||\n      defaultExpressionLanguage.label;\n  }\n\n  isScript() {\n    const { businessObject } = this.props;\n\n    const defaultExpressionLanguage = this.getDefaultExpressionLanguage();\n\n    if (!this._isInputCell()) {\n      return false;\n    }\n\n    if (businessObject.text.indexOf('\\n') !== -1) {\n      return true;\n    }\n\n    return businessObject.expressionLanguage &&\n      businessObject.expressionLanguage !== defaultExpressionLanguage;\n  }\n\n  _isInputCell() {\n    return is(this.props.businessObject, 'dmn:UnaryTests');\n  }\n\n  getDefaultExpressionLanguage() {\n    const elementType = this._isInputCell() ? 'inputCell' : 'outputCell';\n\n    return this._expressionLanguages.getDefault(elementType);\n  }\n\n  getEditor() {\n    return this.isFEEL() ? FeelEditor : ContentEditable;\n  }\n\n  isFEEL() {\n    return this.getExpressionLanguage() === 'feel';\n  }\n\n  getExpressionLanguage() {\n    const { businessObject } = this.props;\n\n    return businessObject.expressionLanguage ||\n      this.getDefaultExpressionLanguage().value;\n  }\n\n  _getVariables() {\n    const { businessObject } = this.props;\n\n    return this._variableResolver &&\n      this._variableResolver.getVariables(businessObject);\n  }\n\n  _getLabel() {\n    return this._isInputCell() ?\n      this._translate('Input') : this._translate('Output');\n  }\n\n  render() {\n    const {\n      businessObject,\n      placeholder,\n      value,\n      onChange\n    } = this.props;\n\n    const description = this.getDescription(businessObject);\n\n    const isDefaultExpressionLanguage = this.isDefaultExpressionLanguage(businessObject);\n\n    const expressionLanguageLabel = this.getExpressionLanguageLabel(businessObject);\n\n    const isScript = this.isScript();\n\n    const Editor = this.getEditor();\n    const variables = this._getVariables();\n\n    return (\n      <div className=\"cell-editor\">\n        {\n          isString(description)\n            && <div className=\"description-indicator\"></div>\n        }\n        <Editor\n          label={ this._getLabel() }\n          className={ isScript ? 'script-editor' : '' }\n          ctrlForNewline={ true }\n          onInput={ onChange }\n          value={ value }\n          placeholder={ placeholder }\n          variables={ variables }\n          feelLanguageDialect=\"unaryTests\"\n        />\n        {\n          !isDefaultExpressionLanguage && (\n            <span\n              className=\"dms-badge dmn-expression-language\"\n              title={ this._translate(\n                'Expression language: {expressionLanguageLabel}',\n                { expressionLanguageLabel }\n              ) }>\n              <span class=\"dms-badge-icon dmn-icon-file-code\"></span>\n              <span class=\"dms-badge-label\">{ expressionLanguageLabel }</span>\n            </span>\n          )\n        }\n      </div>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}