{"version":3,"file":"Manager.js","names":["EventBus","DmnModdle","domify","query","domQuery","remove","domRemove","assign","debounce","every","find","isDefined","isFunction","isNumber","wrapForCompatibility","DEFAULT_CONTAINER_OPTIONS","width","height","position","Manager","constructor","options","_eventBus","_viewsChanged","_views","_viewers","open","bind","importXML","saveXML","_init","xml","self","Promise","resolve","reject","previousActiveView","_activeView","_clear","then","_emit","parseWarnings","_moddle","fromXML","parseResult","definitions","rootElement","references","elementsById","warnings","ParseCompleteEvent","error","_setDefinitions","view","_getInitialView","noDisplayableContentsErr","Error","result","catch","allWarnings","concat","parseError","checkDMNCompatibilityError","checkValidationError","clearError","data","event","createEvent","Object","defineProperty","enumerable","get","console","warn","getDefinitions","_definitions","getActiveView","getActiveViewer","activeView","_getViewer","getView","element","filter","v","getViews","toXML","on","args","off","once","attachTo","parentNode","prototype","jquery","appendChild","_container","detach","destroy","keys","forEach","viewerId","viewer","safeExecute","_options","_createModdle","container","containerOptions","style","ensureUnit","_switchView","_updateViews","views","viewProviders","_getViewProviders","displayableElements","drgElement","newViews","provider","opens","$type","id","name","type","push","newActiveView","viewsEqual","activeViewChanged","viewNameChanged","viewsChanged","length","newView","preferredView","initialView","complete","openError","openResult","activeViewer","newViewer","_createViewer","Viewer","providerOptions","commonOptions","common","additionalModules","_parent","moddle","fire","moddleExtensions","val","err","message","olderDMNVersion","indexOf","pattern","match","exec","a","b","method"],"sources":["../../src/base/Manager.js"],"sourcesContent":["import EventBus from 'diagram-js/lib/core/EventBus';\n\nimport DmnModdle from 'dmn-moddle';\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport {\n  assign,\n  debounce,\n  every,\n  find,\n  isDefined,\n  isFunction,\n  isNumber\n} from 'min-dash';\n\nimport {\n  wrapForCompatibility\n} from '../util/CompatibilityUtils';\n\n\n/**\n * @typedef {import('./View').OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('./View').OpenError} OpenError\n */\n\n\nconst DEFAULT_CONTAINER_OPTIONS = {\n  width: '100%',\n  height: '100%',\n  position: 'relative'\n};\n\n/**\n * The base class for DMN viewers and editors.\n *\n * @abstract\n */\nexport default class Manager {\n\n  /**\n   * Create a new instance with the given options.\n   *\n   * @param  {Object} options\n   *\n   * @return {Manager}\n   */\n  constructor(options = {}) {\n    this._eventBus = new EventBus();\n\n    this._viewsChanged = debounce(this._viewsChanged, 0);\n\n    this._views = [];\n    this._viewers = {};\n\n    // keep support for callbacks\n    this.open = wrapForCompatibility(this.open.bind(this));\n    this.importXML = wrapForCompatibility(this.importXML.bind(this));\n    this.saveXML = wrapForCompatibility(this.saveXML.bind(this));\n\n    this._init(options);\n  }\n\n  /**\n  * The importXML result.\n  *\n  * @typedef {Object} ImportXMLResult\n  *\n  * @property {Array<string>} warnings\n  */\n\n  /**\n  * The importXML error.\n  *\n  * @typedef {Error} ImportXMLError\n  *\n  * @property {Array<string>} warnings\n  */\n\n  /**\n   * Parse and render a DMN diagram.\n   *\n   * Once finished the viewer reports back the result to the\n   * provided callback function with (err, warnings).\n   *\n   * ## Life-Cycle Events\n   *\n   * During import the viewer will fire life-cycle events:\n   *\n   *   * import.parse.start (about to read model from xml)\n   *   * import.parse.complete (model read; may have worked or not)\n   *   * import.render.start (graphical import start)\n   *   * import.render.complete (graphical import finished)\n   *   * import.done (everything done)\n   *\n   * You can use these events to hook into the life-cycle.\n   *\n   * @param {string} xml the DMN xml\n   * @param {Object} [options]\n   * @param {boolean} [options.open=true]\n   *\n   * @return {Promise<ImportXMLResult, ImportXMLError>}\n   */\n  importXML(xml, options) {\n    var self = this;\n\n    options = options || { open: true };\n\n    return new Promise(function(resolve, reject) {\n      var previousActiveView = self._activeView;\n\n      // clean up previously rendered diagram before new import\n      self._clear().then(() => {\n\n        // hook in pre-parse listeners +\n        // allow xml manipulation\n        xml = self._emit('import.parse.start', { xml: xml }) || xml;\n\n        var parseWarnings;\n\n        self._moddle.fromXML(xml, 'dmn:Definitions').then((parseResult) => {\n\n          var definitions = parseResult.rootElement;\n          var references = parseResult.references;\n          var elementsById = parseResult.elementsById;\n          parseWarnings = parseResult.warnings;\n\n          // hook in post parse listeners +\n          // allow definitions manipulation\n          definitions = self._emit('import.parse.complete', ParseCompleteEvent({\n            error: null,\n            definitions: definitions,\n            elementsById: elementsById,\n            references: references,\n            warnings: parseWarnings\n          })) || definitions;\n          self._setDefinitions(definitions);\n\n          if (!options.open) {\n            self._emit('import.done', { error: null, warnings: parseWarnings });\n\n            resolve({ warnings: parseWarnings });\n            return;\n          }\n\n          // open either previously active view or view of the same type if available\n          var view = self._getInitialView(self._views, previousActiveView);\n\n          if (!view) {\n            var noDisplayableContentsErr = new Error('no displayable contents');\n\n            self._emit('import.done',\n              { error: noDisplayableContentsErr, warnings: parseWarnings });\n\n            noDisplayableContentsErr.warnings = parseWarnings;\n\n            return reject(noDisplayableContentsErr);\n          }\n\n          self.open(view)\n            .then(result => ({ warnings: result.warnings }))\n            .catch(error => ({ error: error, warnings: error.warnings }))\n            .then(result => {\n              var allWarnings = [].concat(parseWarnings, result.warnings);\n\n              self._emit('import.done', { error: result.error, warnings: allWarnings });\n\n              if (result.error) {\n                result.error.warnings = allWarnings;\n                reject(result.error);\n              } else {\n                resolve({ warnings: allWarnings });\n              }\n\n            });\n        }).catch((parseError) => {\n\n          parseWarnings = parseError.warnings;\n\n          parseError = checkDMNCompatibilityError(parseError, xml) ||\n            checkValidationError(parseError) ||\n            parseError;\n\n          self._emit('import.parse.complete', ParseCompleteEvent({\n            error: parseError,\n            warnings: parseWarnings\n          }));\n\n          self._emit('import.done', { error: parseError, warnings: parseWarnings });\n\n          parseError.warnings = parseWarnings;\n\n          return reject(parseError);\n        });\n      }).catch(clearError => {\n        self._emit('import.done', { error: clearError, warnings: [] });\n        clearError.warnings = [];\n\n        return reject(clearError);\n      });\n    });\n\n    // TODO: remove with future dmn-js version\n    function ParseCompleteEvent(data) {\n\n      var event = self._eventBus.createEvent(data);\n\n      Object.defineProperty(event, 'context', {\n        enumerable: true,\n        get: function() {\n\n          console.warn(new Error(\n            'import.parse.complete <context> is deprecated ' +\n            'and will be removed in future library versions'\n          ));\n\n          return {\n            warnings: data.warnings,\n            references: data.references,\n            elementsById: data.elementsById\n          };\n        }\n      });\n\n      return event;\n    }\n  }\n\n  getDefinitions() {\n    return this._definitions;\n  }\n\n  /**\n   * Return active view.\n   *\n   * @return {View}\n   */\n  getActiveView() {\n    return this._activeView;\n  }\n\n  /**\n   * Get the currently active viewer instance.\n   *\n   * @return {View}\n   */\n  getActiveViewer() {\n    var activeView = this.getActiveView();\n\n    return activeView && this._getViewer(activeView);\n  }\n\n  getView(element) {\n    return this._views.filter(function(v) {\n      return v.element === element;\n    })[0];\n  }\n\n  getViews() {\n    return this._views;\n  }\n\n  /**\n   * The saveXML result.\n   *\n   * @typedef {Object} SaveXMLResult\n   *\n   * @property {string} xml\n   */\n\n  /**\n   * Export the currently displayed DMN diagram as\n   * a DMN XML document.\n   *\n   * ## Life-Cycle Events\n   *\n   * During XML saving the viewer will fire life-cycle events:\n   *\n   *   * saveXML.start (before serialization)\n   *   * saveXML.serialized (after xml generation)\n   *   * saveXML.done (everything done)\n   *\n   * You can use these events to hook into the life-cycle.\n   *\n   * @param {Object} [options] export options\n   * @param {boolean} [options.format=false] output formated XML\n   * @param {boolean} [options.preamble=true] output preamble\n   *\n   * @return {Promise<SaveXMLResult, Error>}\n   */\n  saveXML(options) {\n    var self = this;\n\n    options = options || {};\n\n    var definitions = this._definitions;\n\n    return new Promise(function(resolve, reject) {\n\n      if (!definitions) {\n        reject(new Error('no definitions loaded'));\n        return;\n      }\n\n      // allow to fiddle around with definitions\n      definitions = self._emit('saveXML.start', {\n        definitions: definitions\n      }) || definitions;\n\n      self._moddle.toXML(definitions, options)\n        .then(function(result) {\n\n          var xml = result.xml;\n\n          xml = self._emit('saveXML.serialized', {\n            xml: xml\n          }) || xml;\n\n          return { xml };\n        }).catch((error) => ({ error }))\n        .then((result) => {\n\n          self._emit('saveXML.done', result);\n\n          if (result.error) {\n            reject(result.error);\n          } else {\n            resolve({ xml: result.xml });\n          }\n        });\n\n    });\n\n  }\n\n  /**\n   * Register an event listener\n   *\n   * Remove a previously added listener via {@link #off(event, callback)}.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  on(...args) {\n    this._eventBus.on(...args);\n  }\n\n  /**\n   * De-register an event listener\n   *\n   * @param {string} event\n   * @param {Function} callback\n   */\n  off(...args) {\n    this._eventBus.off(...args);\n  }\n\n  /**\n   * Register a listener to be invoked once only.\n   *\n   * @param {string} event\n   * @param {number} [priority]\n   * @param {Function} callback\n   * @param {Object} [that]\n   */\n  once(...args) {\n    this._eventBus.once(...args);\n  }\n\n  attachTo(parentNode) {\n\n    // unwrap jQuery if provided\n    if (parentNode.get && parentNode.constructor.prototype.jquery) {\n      parentNode = parentNode.get(0);\n    }\n\n    if (typeof parentNode === 'string') {\n      parentNode = domQuery(parentNode);\n    }\n\n    parentNode.appendChild(this._container);\n\n    this._emit('attach', {});\n  }\n\n  detach() {\n    this._emit('detach', {});\n\n    domRemove(this._container);\n  }\n\n  destroy() {\n    Object.keys(this._viewers).forEach((viewerId) => {\n      var viewer = this._viewers[viewerId];\n\n      safeExecute(viewer, 'destroy');\n    });\n\n    domRemove(this._container);\n  }\n\n  _init(options) {\n    this._options = options;\n\n    this._moddle = this._createModdle(options);\n\n    this._viewers = {};\n    this._views = [];\n\n    const container = domify('<div class=\"dmn-js-parent\"></div>');\n\n    const containerOptions = assign({}, DEFAULT_CONTAINER_OPTIONS, options);\n\n    assign(container.style, {\n      width: ensureUnit(containerOptions.width),\n      height: ensureUnit(containerOptions.height),\n      position: containerOptions.position\n    });\n\n    this._container = container;\n\n    if (options.container) {\n      this.attachTo(options.container);\n    }\n  }\n\n  _clear() {\n    return this._switchView(null);\n  }\n\n  /**\n   * Open diagram view.\n   *\n   * @param  {View} view\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  open(view) {\n    return this._switchView(view);\n  }\n\n  _setDefinitions(definitions) {\n    this._definitions = definitions;\n\n    this._updateViews();\n  }\n\n  _viewsChanged = () => {\n    this._emit('views.changed', {\n      views: this._views,\n      activeView: this._activeView\n    });\n  };\n\n  /**\n   * Recompute changed views after elements in\n   * the DMN diagram have changed.\n   */\n  _updateViews() {\n\n    var definitions = this._definitions;\n\n    if (!definitions) {\n      this._views = [];\n      this._switchView(null);\n\n      return;\n    }\n\n    var viewProviders = this._getViewProviders();\n\n    var displayableElements = [ definitions, ...(definitions.drgElement || []) ];\n\n    // compute list of available views\n    var views = this._views,\n        newViews = [];\n\n    for (var element of displayableElements) {\n      var provider = find(viewProviders, function(provider) {\n        if (typeof provider.opens === 'string') {\n          return provider.opens === element.$type;\n        } else {\n          return provider.opens(element);\n        }\n      });\n\n      if (!provider) {\n        continue;\n      }\n\n      var view = {\n        element,\n        id: element.id,\n        name: element.name,\n        type: provider.id\n      };\n\n      newViews.push(view);\n    }\n\n    var activeView = this._activeView,\n        newActiveView;\n\n    if (activeView) {\n\n      // check the new active view\n      newActiveView = find(newViews, function(view) {\n        return viewsEqual(activeView, view);\n      }) || this._getInitialView(newViews);\n\n      if (!newActiveView) {\n        this._switchView(null);\n        return;\n      }\n    }\n\n    // Views have changed if\n    // active view has changed OR\n    // number of views has changed OR\n    // not all views equal\n    var activeViewChanged = !viewsEqual(activeView, newActiveView)\n      || viewNameChanged(activeView, newActiveView);\n\n    var viewsChanged = views.length !== newViews.length\n        || !every(newViews, function(newView) {\n          return find(views, function(view) {\n            return viewsEqual(view, newView) && !viewNameChanged(view, newView);\n          });\n        });\n\n    this._activeView = newActiveView;\n    this._views = newViews;\n\n    if (activeViewChanged || viewsChanged) {\n      this._viewsChanged();\n    }\n  }\n\n  _getInitialView(views, preferredView) {\n    var initialView;\n\n    if (preferredView) {\n      initialView = find(views, function(view) {\n        return viewsEqual(view, preferredView);\n      }) || find(views, function(view) {\n        return view.type === preferredView;\n      });\n    }\n\n    return initialView || views[0];\n  }\n\n  /**\n   * Switch to another view.\n   *\n   * @param  {View} newView\n   * @returns {Promise} Resolves with {OpenResult} when successful\n   * or rejects with {OpenError}\n   */\n  _switchView(newView) {\n    var self = this;\n\n    return new Promise(function(resolve, reject) {\n      var complete = (openError, openResult) => {\n        self._viewsChanged();\n\n        if (openError) {\n          reject(openError);\n        } else {\n          resolve(openResult);\n        }\n      };\n\n      var activeView = self.getActiveView(),\n          activeViewer;\n\n      var newViewer = newView && self._getViewer(newView),\n          element = newView && newView.element;\n\n      if (activeView) {\n        activeViewer = self._getViewer(activeView);\n\n        if (activeViewer !== newViewer) {\n          safeExecute(activeViewer, 'clear');\n\n          activeViewer.detach();\n        }\n      }\n\n      self._activeView = newView;\n\n      if (newViewer) {\n\n        if (activeViewer !== newViewer) {\n          newViewer.attachTo(self._container);\n        }\n\n        self._emit('import.render.start', {\n          view: newView,\n          element: element\n        });\n\n        newViewer.open(element)\n          .then(\n            result => {\n              self._emit('import.render.complete', {\n                view: newView,\n                error: null,\n                warnings: result.warnings\n              });\n\n              complete(null, result);\n            })\n          .catch(\n            error => {\n              self._emit('import.render.complete', {\n                view: newView,\n                error: error,\n                warnings: error.warnings\n              });\n\n              complete(error, null);\n            }\n          );\n\n        return;\n      }\n\n      // no active view\n      complete();\n    });\n  }\n\n  _getViewer(view) {\n\n    var type = view.type;\n\n    var viewer = this._viewers[type];\n\n    if (!viewer) {\n      viewer = this._viewers[type] = this._createViewer(view.type);\n\n      this._emit('viewer.created', {\n        type: type,\n        viewer: viewer\n      });\n    }\n\n    return viewer;\n  }\n\n  _createViewer(id) {\n\n    var provider = find(this._getViewProviders(), function(provider) {\n      return provider.id === id;\n    });\n\n    if (!provider) {\n      throw new Error('no provider for view type <' + id + '>');\n    }\n\n    var Viewer = provider.constructor;\n\n    var providerOptions = this._options[id] || {};\n    var commonOptions = this._options.common || {};\n\n    return new Viewer({\n      ...commonOptions,\n      ...providerOptions,\n      additionalModules: [\n        ...(providerOptions.additionalModules || []), {\n          _parent: [ 'value', this ],\n          moddle: [ 'value', this._moddle ]\n        }\n      ]\n    });\n  }\n\n  /**\n   * Emit an event.\n   */\n  _emit(...args) {\n    return this._eventBus.fire(...args);\n  }\n\n  _createModdle(options) {\n    return new DmnModdle(options.moddleExtensions);\n  }\n\n  /**\n   * Return the list of available view providers.\n   *\n   * @abstract\n   *\n   * @return {Array<ViewProvider>}\n   */\n  _getViewProviders() {\n    return [];\n  }\n\n}\n\n\n// helpers //////////////////////\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? 'px' : '');\n}\n\nfunction checkDMNCompatibilityError(err, xml) {\n\n  // check if we can indicate opening of old DMN 1.1 or DMN 1.2 diagrams\n\n  if (err.message !== 'failed to parse document as <dmn:Definitions>') {\n    return null;\n  }\n\n  var olderDMNVersion = (\n    (xml.indexOf('\"http://www.omg.org/spec/DMN/20151101/dmn.xsd\"') !== -1 && '1.1') ||\n    (xml.indexOf('\"http://www.omg.org/spec/DMN/20180521/MODEL/\"') !== -1 && '1.2')\n  );\n\n  if (!olderDMNVersion) {\n    return null;\n  }\n\n  err = new Error(\n    'unsupported DMN ' + olderDMNVersion + ' file detected; ' +\n    'only DMN 1.3 files can be opened'\n  );\n\n  console.error(\n    'Cannot open what looks like a DMN ' + olderDMNVersion + ' diagram. ' +\n    'Please refer to https://bpmn.io/l/dmn-compatibility.html ' +\n    'to learn how to make the toolkit compatible with older DMN files',\n    err\n  );\n\n  return err;\n}\n\nfunction checkValidationError(err) {\n\n  // check if we can help the user by indicating wrong DMN 1.3 xml\n  // (in case he or the exporting tool did not get that right)\n\n  var pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/,\n      match = pattern.exec(err.message);\n\n  if (!match) {\n    return null;\n  }\n\n  err.message =\n    'unparsable content <' + match[ 1 ] + '> detected; ' +\n    'this may indicate an invalid DMN 1.3 diagram file' + match[ 2 ];\n\n  return err;\n}\n\nfunction viewsEqual(a, b) {\n  if (!isDefined(a)) {\n    if (!isDefined(b)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  if (!isDefined(b)) {\n    return false;\n  }\n\n  // compare by element OR element ID equality\n  return a.element === b.element || a.id === b.id;\n}\n\nfunction viewNameChanged(a, b) {\n  return !a || !b || a.name !== b.name;\n}\n\nfunction safeExecute(viewer, method) {\n  if (isFunction(viewer[ method ])) {\n    viewer[ method ]();\n  }\n}\n"],"mappings":"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","ignoreList":[]}