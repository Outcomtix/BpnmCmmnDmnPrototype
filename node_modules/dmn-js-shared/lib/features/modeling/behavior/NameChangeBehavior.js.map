{"version":3,"file":"NameChangeBehavior.js","names":["CommandInterceptor","getBusinessObject","is","NameChangeBehavior","$inject","constructor","eventBus","modeling","_modeling","postExecuted","updateVariableFromElement","updateVariableFromLabel","context","element","newLabel","bo","variable","updateProperties","name","properties","isNameChanged","isVariable","shouldSyncVariable","syncElementVariableChange","parent","getParent","get","businessObject","$parent"],"sources":["../../../../src/features/modeling/behavior/NameChangeBehavior.js"],"sourcesContent":["import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\n\nexport default class NameChangeBehavior extends CommandInterceptor {\n\n  static $inject = [ 'eventBus', 'modeling' ];\n\n  constructor(eventBus, modeling) {\n    super(eventBus);\n\n    this._modeling = modeling;\n\n    this.postExecuted('element.updateProperties', this.updateVariableFromElement);\n    this.postExecuted('element.updateLabel', this.updateVariableFromLabel);\n  }\n\n  updateVariableFromLabel = ({ context }) => {\n    const { element, newLabel } = context;\n    const bo = getBusinessObject(element),\n          variable = bo.variable;\n\n    if (!variable) {\n      return;\n    }\n\n    this._modeling.updateProperties(variable, { name: newLabel });\n  };\n\n  updateVariableFromElement = ({ context }) => {\n    const { element, properties } = context;\n    const bo = getBusinessObject(element);\n\n    if (!bo.variable) {\n      return;\n    }\n\n    if (!(is(element, 'dmn:Decision') || is(element, 'dmn:BusinessKnowledgeModel'))) {\n      return;\n    }\n\n    if (!this.isNameChanged(properties)) {\n      return;\n    }\n\n    if (this.isVariable(element)) {\n      return;\n    }\n\n    else if (!this.shouldSyncVariable(element)) {\n      this.syncElementVariableChange(bo);\n    }\n  };\n\n  isNameChanged(properties) {\n    return 'name' in properties;\n  }\n\n  isVariable(element) {\n    const parent = getParent(element);\n    return (\n      is(element, 'dmn:InformationItem') &&\n      parent && parent.get('variable') === element\n    );\n  }\n\n  shouldSyncVariable(element) {\n    const bo = getBusinessObject(element),\n          variable = bo.get('variable');\n    return variable && (bo.name === variable.name);\n  }\n\n  syncElementVariableChange(businessObject) {\n    const name = businessObject.get('name');\n    const variable = businessObject.variable;\n    this._modeling.updateProperties(variable, { name });\n  }\n}\n\n// helpers //////////////////////\n\nfunction getParent(element) {\n  return element.$parent;\n}"],"mappings":"AAAA,OAAOA,kBAAkB,MAAM,2CAA2C;AAE1E,SACEC,iBAAiB,EACjBC,EAAE,QACG,kCAAkC;AAGzC,eAAe,MAAMC,kBAAkB,SAASH,kBAAkB,CAAC;EAEjE,OAAOI,OAAO,GAAG,CAAE,UAAU,EAAE,UAAU,CAAE;EAE3CC,WAAWA,CAACC,QAAQ,EAAEC,QAAQ,EAAE;IAC9B,KAAK,CAACD,QAAQ,CAAC;IAEf,IAAI,CAACE,SAAS,GAAGD,QAAQ;IAEzB,IAAI,CAACE,YAAY,CAAC,0BAA0B,EAAE,IAAI,CAACC,yBAAyB,CAAC;IAC7E,IAAI,CAACD,YAAY,CAAC,qBAAqB,EAAE,IAAI,CAACE,uBAAuB,CAAC;EACxE;EAEAA,uBAAuB,GAAGA,CAAC;IAAEC;EAAQ,CAAC,KAAK;IACzC,MAAM;MAAEC,OAAO;MAAEC;IAAS,CAAC,GAAGF,OAAO;IACrC,MAAMG,EAAE,GAAGd,iBAAiB,CAACY,OAAO,CAAC;MAC/BG,QAAQ,GAAGD,EAAE,CAACC,QAAQ;IAE5B,IAAI,CAACA,QAAQ,EAAE;MACb;IACF;IAEA,IAAI,CAACR,SAAS,CAACS,gBAAgB,CAACD,QAAQ,EAAE;MAAEE,IAAI,EAAEJ;IAAS,CAAC,CAAC;EAC/D,CAAC;EAEDJ,yBAAyB,GAAGA,CAAC;IAAEE;EAAQ,CAAC,KAAK;IAC3C,MAAM;MAAEC,OAAO;MAAEM;IAAW,CAAC,GAAGP,OAAO;IACvC,MAAMG,EAAE,GAAGd,iBAAiB,CAACY,OAAO,CAAC;IAErC,IAAI,CAACE,EAAE,CAACC,QAAQ,EAAE;MAChB;IACF;IAEA,IAAI,EAAEd,EAAE,CAACW,OAAO,EAAE,cAAc,CAAC,IAAIX,EAAE,CAACW,OAAO,EAAE,4BAA4B,CAAC,CAAC,EAAE;MAC/E;IACF;IAEA,IAAI,CAAC,IAAI,CAACO,aAAa,CAACD,UAAU,CAAC,EAAE;MACnC;IACF;IAEA,IAAI,IAAI,CAACE,UAAU,CAACR,OAAO,CAAC,EAAE;MAC5B;IACF,CAAC,MAEI,IAAI,CAAC,IAAI,CAACS,kBAAkB,CAACT,OAAO,CAAC,EAAE;MAC1C,IAAI,CAACU,yBAAyB,CAACR,EAAE,CAAC;IACpC;EACF,CAAC;EAEDK,aAAaA,CAACD,UAAU,EAAE;IACxB,OAAO,MAAM,IAAIA,UAAU;EAC7B;EAEAE,UAAUA,CAACR,OAAO,EAAE;IAClB,MAAMW,MAAM,GAAGC,SAAS,CAACZ,OAAO,CAAC;IACjC,OACEX,EAAE,CAACW,OAAO,EAAE,qBAAqB,CAAC,IAClCW,MAAM,IAAIA,MAAM,CAACE,GAAG,CAAC,UAAU,CAAC,KAAKb,OAAO;EAEhD;EAEAS,kBAAkBA,CAACT,OAAO,EAAE;IAC1B,MAAME,EAAE,GAAGd,iBAAiB,CAACY,OAAO,CAAC;MAC/BG,QAAQ,GAAGD,EAAE,CAACW,GAAG,CAAC,UAAU,CAAC;IACnC,OAAOV,QAAQ,IAAKD,EAAE,CAACG,IAAI,KAAKF,QAAQ,CAACE,IAAK;EAChD;EAEAK,yBAAyBA,CAACI,cAAc,EAAE;IACxC,MAAMT,IAAI,GAAGS,cAAc,CAACD,GAAG,CAAC,MAAM,CAAC;IACvC,MAAMV,QAAQ,GAAGW,cAAc,CAACX,QAAQ;IACxC,IAAI,CAACR,SAAS,CAACS,gBAAgB,CAACD,QAAQ,EAAE;MAAEE;IAAK,CAAC,CAAC;EACrD;AACF;;AAEA;;AAEA,SAASO,SAASA,CAACZ,OAAO,EAAE;EAC1B,OAAOA,OAAO,CAACe,OAAO;AACxB","ignoreList":[]}