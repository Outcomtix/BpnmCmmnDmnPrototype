{"version":3,"file":"Viewer.js","names":["BaseViewer","assign","domify","remove","domRemove","TranslateModule","RenderModule","PoweredByModule","LiteralExpressionModule","FunctionDefinitionEditorModule","ViewDrdModule","ElementPropertiesModule","ElementLogicModule","ElementVariableModule","Viewer","constructor","options","container","_createContainer","renderer","_container","open","element","eventBus","get","Promise","resolve","reject","err","rootElement","getRootElement","clear","fire","_setRootElement","e","warnings","_init","modules","additionalModules","config","baseModules","getModules","extraModules","staticModules","viewer","allModules","on","event","priority","callback","target","off","_emit","type","_root","attachTo","parentNode","Error","detach","appendChild","destroy"],"sources":["../src/Viewer.js"],"sourcesContent":["import BaseViewer from 'dmn-js-shared/lib/base/viewer/Viewer';\r\n\r\nimport {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\r\n\r\nimport RenderModule from './render';\r\nimport PoweredByModule from './features/powered-by';\r\nimport LiteralExpressionModule from './features/literal-expression';\r\nimport FunctionDefinitionEditorModule from './features/function-definition';\r\nimport ViewDrdModule from './features/view-drd';\r\nimport ElementPropertiesModule from './features/element-properties';\r\nimport ElementLogicModule from './features/element-logic';\r\nimport ElementVariableModule from './features/element-variable';\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\r\n */\r\n\r\n/**\r\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\r\n */\r\n\r\n\r\nexport class Viewer extends BaseViewer {\r\n\r\n  constructor(options = {}) {\r\n    const container = Viewer._createContainer();\r\n\r\n    super(assign(options, {\r\n      renderer: {\r\n        container\r\n      }\r\n    }));\r\n\r\n    this._container = container;\r\n  }\r\n\r\n  /**\r\n   * Open diagram element.\r\n   *\r\n   * @param  {ModdleElement} element\r\n   * @returns {Promise} Resolves with {OpenResult} when successful\r\n   * or rejects with {OpenError}\r\n   */\r\n  open(element) {\r\n    const eventBus = this.get('eventBus');\r\n\r\n    return new Promise((resolve, reject) => {\r\n      let err;\r\n\r\n      // use try/catch to not swallow synchronous exceptions\r\n      // that may be raised during model parsing\r\n      try {\r\n        const rootElement = this.getRootElement();\r\n\r\n        if (rootElement) {\r\n\r\n          // clear existing literal expression\r\n          this.clear();\r\n\r\n          // unmount first\r\n          eventBus.fire('renderer.unmount');\r\n        }\r\n\r\n        // update literal expression\r\n        this._setRootElement(element);\r\n\r\n        // let others know about import\r\n        eventBus.fire('import', element);\r\n\r\n        eventBus.fire('renderer.mount');\r\n      } catch (e) {\r\n        err = e;\r\n      }\r\n\r\n      // handle synchronously thrown exception\r\n      if (err) {\r\n        err.warnings = err.warnings || [];\r\n        reject(err);\r\n      } else {\r\n        resolve({ warnings: [] });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize the viewer, returning { modules: [], config }.\r\n   *\r\n   * @param  {Object} options\r\n   *\r\n   * @return {Object} init config\r\n   */\r\n  _init(options) {\r\n\r\n    let {\r\n      modules,\r\n      additionalModules,\r\n      ...config\r\n    } = options;\r\n\r\n    let baseModules = modules || this.getModules();\r\n    let extraModules = additionalModules || [];\r\n    let staticModules = [\r\n      {\r\n        viewer: [ 'value', this ]\r\n      }\r\n    ];\r\n\r\n    let allModules = [\r\n      ...baseModules,\r\n      ...extraModules,\r\n      ...staticModules\r\n    ];\r\n\r\n    return {\r\n      modules: allModules,\r\n      config\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register an event listener\r\n   *\r\n   * Remove a previously added listener via {@link #off(event, callback)}.\r\n   *\r\n   * @param {string} event\r\n   * @param {number} [priority]\r\n   * @param {Function} callback\r\n   * @param {Object} [that]\r\n   */\r\n  on(event, priority, callback, target) {\r\n    return this.get('eventBus').on(event, priority, callback, target);\r\n  }\r\n\r\n  /**\r\n   * De-register an event listener\r\n   *\r\n   * @param {string} event\r\n   * @param {Function} callback\r\n   */\r\n  off(event, callback) {\r\n    this.get('eventBus').off(event, callback);\r\n  }\r\n\r\n  /**\r\n   * Emit an event on the underlying {@link EventBus}\r\n   *\r\n   * @param  {string} type\r\n   * @param  {Object} event\r\n   *\r\n   * @return {Object} event processing result (if any)\r\n   */\r\n  _emit(type, event) {\r\n    return this.get('eventBus').fire(type, event);\r\n  }\r\n\r\n  /**\r\n   * Returns the currently displayed element.\r\n   *\r\n   * @return {ModdleElement}\r\n   */\r\n  getRootElement() {\r\n    return this._root;\r\n  }\r\n\r\n  _setRootElement(element) {\r\n    this._root = element;\r\n  }\r\n\r\n  /**\r\n   * Attach viewer to given parent node.\r\n   *\r\n   * @param  {Element} parentNode\r\n   */\r\n  attachTo(parentNode) {\r\n\r\n    if (!parentNode) {\r\n      throw new Error('parentNode required');\r\n    }\r\n\r\n    // ensure we detach from the\r\n    // previous, old parent\r\n    this.detach();\r\n\r\n    parentNode.appendChild(this._container);\r\n\r\n    this._emit('attach', {});\r\n  }\r\n\r\n  /**\r\n   * Detach viewer from parent node, if attached.\r\n   */\r\n  detach() {\r\n\r\n    const container = this._container,\r\n          parentNode = container.parentNode;\r\n\r\n    if (!parentNode) {\r\n      return;\r\n    }\r\n\r\n    this._emit('detach', {});\r\n\r\n    domRemove(container);\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n\r\n    this.detach();\r\n  }\r\n\r\n  getModules() {\r\n    return [\r\n      RenderModule,\r\n      TranslateModule,\r\n      PoweredByModule,\r\n      ViewDrdModule,\r\n      ElementPropertiesModule,\r\n      ElementLogicModule,\r\n      FunctionDefinitionEditorModule,\r\n      LiteralExpressionModule,\r\n      ElementVariableModule\r\n    ];\r\n  }\r\n\r\n\r\n  static _createContainer() {\r\n    return domify(\r\n      '<div class=\"dmn-boxed-expression-container\"></div>'\r\n    );\r\n  }\r\n\r\n}\r\n"],"mappings":"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","ignoreList":[]}