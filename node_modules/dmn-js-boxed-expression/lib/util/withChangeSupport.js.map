{"version":3,"file":"withChangeSupport.js","names":["Component","withChangeSupport","WrappedComponent","selectDependencies","props","normalizeProps","createComponentVNode","Wrapper","constructor","context","_eventBus","injector","get","componentDidMount","_subscribe","componentWillUnmount","_unsubscribe","on","onChange","off","elements","dependencies","_selectDependencies","some","dep","includes","forceUpdate","render","_component"],"sources":["../../src/util/withChangeSupport.js"],"sourcesContent":["import { Component } from 'inferno';\n\n/**\n *\n *\n * @param {*} WrappedComponent\n * @param {() => []} selectDependencies\n * @returns\n */\nexport function withChangeSupport(WrappedComponent, selectDependencies) {\n  return function(props) {\n    return <Wrapper\n      { ...props }\n      _component={ WrappedComponent }\n      _selectDependencies={ selectDependencies }\n    />;\n  };\n}\n\nclass Wrapper extends Component {\n  constructor(props, context) {\n    super(props, context);\n\n    this._eventBus = context.injector.get('eventBus');\n  }\n\n  componentDidMount() {\n    this._subscribe();\n  }\n\n  componentWillUnmount() {\n    this._unsubscribe();\n  }\n\n  _subscribe() {\n    this._eventBus.on('elements.changed', this.onChange);\n  }\n\n  _unsubscribe() {\n    this._eventBus.off('elements.changed', this.onChange);\n  }\n\n  onChange = ({ elements }) => {\n    const dependencies = this.props._selectDependencies(this.props);\n\n    if (dependencies.some(dep => elements.includes(dep))) {\n      this.forceUpdate();\n    }\n  };\n\n  render() {\n    const WrappedComponent = this.props._component;\n\n    return <WrappedComponent { ...this.props } />;\n  }\n}"],"mappings":";AAAA,SAASA,SAAS,QAAQ,SAAS;;AAEnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,iBAAiBA,CAACC,gBAAgB,EAAEC,kBAAkB,EAAE;EACtE,OAAO,UAASC,KAAK,EAAE;IACrB,OAAAC,cAAA,CAAAC,oBAAA,IAAAC,OAAA;MAAA,GACOH,KAAK;MAAA,cACGF,gBAAgB;MAAA,uBACPC;IAAkB;EAE5C,CAAC;AACH;AAEA,MAAMI,OAAO,SAASP,SAAS,CAAC;EAC9BQ,WAAWA,CAACJ,KAAK,EAAEK,OAAO,EAAE;IAC1B,KAAK,CAACL,KAAK,EAAEK,OAAO,CAAC;IAErB,IAAI,CAACC,SAAS,GAAGD,OAAO,CAACE,QAAQ,CAACC,GAAG,CAAC,UAAU,CAAC;EACnD;EAEAC,iBAAiBA,CAAA,EAAG;IAClB,IAAI,CAACC,UAAU,CAAC,CAAC;EACnB;EAEAC,oBAAoBA,CAAA,EAAG;IACrB,IAAI,CAACC,YAAY,CAAC,CAAC;EACrB;EAEAF,UAAUA,CAAA,EAAG;IACX,IAAI,CAACJ,SAAS,CAACO,EAAE,CAAC,kBAAkB,EAAE,IAAI,CAACC,QAAQ,CAAC;EACtD;EAEAF,YAAYA,CAAA,EAAG;IACb,IAAI,CAACN,SAAS,CAACS,GAAG,CAAC,kBAAkB,EAAE,IAAI,CAACD,QAAQ,CAAC;EACvD;EAEAA,QAAQ,GAAGA,CAAC;IAAEE;EAAS,CAAC,KAAK;IAC3B,MAAMC,YAAY,GAAG,IAAI,CAACjB,KAAK,CAACkB,mBAAmB,CAAC,IAAI,CAAClB,KAAK,CAAC;IAE/D,IAAIiB,YAAY,CAACE,IAAI,CAACC,GAAG,IAAIJ,QAAQ,CAACK,QAAQ,CAACD,GAAG,CAAC,CAAC,EAAE;MACpD,IAAI,CAACE,WAAW,CAAC,CAAC;IACpB;EACF,CAAC;EAEDC,MAAMA,CAAA,EAAG;IACP,MAAMzB,gBAAgB,GAAG,IAAI,CAACE,KAAK,CAACwB,UAAU;IAE9C,OAAAvB,cAAA,CAAAC,oBAAA,IAAAJ,gBAAA;MAAA,GAA8B,IAAI,CAACE;IAAK;EAC1C;AACF","ignoreList":[]}