{"version":3,"file":"ReplaceMenuProvider.js","names":["getBoxedExpression","is","forEach","filter","replaceOptions","ReplaceMenuProvider","popupMenu","modeling","moddle","drdReplace","rules","translate","_popupMenu","_modeling","_moddle","_drdReplace","_rules","_translate","register","$inject","prototype","registerProvider","getEntries","element","businessObject","options","boxedExpression","allowed","DECISION","option","notEmpty","actionName","notTable","notExp","_createEntries","BKM","menuEntries","self","definition","entry","_createMenuEntry","push","action","replaceElement","replaceAction","target","menuEntry","label","className","id","getHeaderEntries"],"sources":["../../../src/features/popup-menu/ReplaceMenuProvider.js"],"sourcesContent":["import {\n  getBoxedExpression,\n  is\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  forEach,\n  filter\n} from 'min-dash';\n\nimport replaceOptions from '../replace/ReplaceOptions';\n\n\n/**\n * This module is an element agnostic replace menu provider for the popup menu.\n */\nexport default function ReplaceMenuProvider(\n    popupMenu, modeling, moddle,\n    drdReplace, rules, translate) {\n\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._moddle = moddle;\n  this._drdReplace = drdReplace;\n  this._rules = rules;\n  this._translate = translate;\n\n  this.register();\n}\n\nReplaceMenuProvider.$inject = [\n  'popupMenu',\n  'modeling',\n  'moddle',\n  'drdReplace',\n  'rules',\n  'translate'\n];\n\n\n/**\n * Register replace menu provider in the popup menu\n */\nReplaceMenuProvider.prototype.register = function() {\n  this._popupMenu.registerProvider('dmn-replace', this);\n};\n\n\n/**\n * Get all entries from replaceOptions for the given element.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nReplaceMenuProvider.prototype.getEntries = function(element) {\n\n  var businessObject = element.businessObject;\n\n  var rules = this._rules,\n      options,\n      boxedExpression;\n\n  if (!rules.allowed('shape.replace', { element: element })) {\n    return [];\n  }\n\n  if (is(businessObject, 'dmn:Decision')) {\n    boxedExpression = getBoxedExpression(businessObject);\n\n    options = filter(replaceOptions.DECISION, function(option) {\n      var notEmpty = (\n        option.actionName === 'replace-with-empty-decision' &&\n        boxedExpression\n      );\n      var notTable = (\n        option.actionName === 'replace-with-decision-table' &&\n        !is(boxedExpression, 'dmn:DecisionTable')\n      );\n      var notExp = (\n        option.actionName === 'replace-with-literal-expression' &&\n        !is(boxedExpression, 'dmn:LiteralExpression')\n      );\n\n      return notEmpty || notTable || notExp;\n    });\n\n    return this._createEntries(element, options);\n  }\n\n  if (is(businessObject, 'dmn:BusinessKnowledgeModel')) {\n    boxedExpression = getBoxedExpression(businessObject);\n\n    options = filter(replaceOptions.BKM, function(option) {\n      var notEmpty = (\n        option.actionName === 'replace-with-empty' &&\n        boxedExpression\n      );\n      var notTable = (\n        option.actionName === 'replace-with-decision-table' &&\n        !is(boxedExpression, 'dmn:DecisionTable')\n      );\n      var notExp = (\n        option.actionName === 'replace-with-literal-expression' &&\n        !is(boxedExpression, 'dmn:LiteralExpression')\n      );\n\n      return notEmpty || notTable || notExp;\n    });\n\n    return this._createEntries(element, options);\n  }\n\n  return [];\n};\n\n\n/**\n * Creates an array of menu entry objects for a given element.\n *\n * @param  {djs.model.Base} element\n * @param  {Object} replaceOptions\n *\n * @return {Array<Object>} a list of menu items\n */\nReplaceMenuProvider.prototype._createEntries = function(element, replaceOptions) {\n  var menuEntries = [];\n\n  var self = this;\n\n  forEach(replaceOptions, function(definition) {\n    var entry = self._createMenuEntry(definition, element);\n\n    menuEntries.push(entry);\n  });\n\n  return menuEntries;\n};\n\n\n/**\n * Creates and returns a single menu entry item.\n *\n * @param  {Object} definition a single replace options definition object\n * @param  {djs.model.Base} element\n * @param  {Function} [action] an action callback function which gets called when\n *                             the menu entry is being triggered.\n *\n * @return {Object} menu entry item\n */\nReplaceMenuProvider.prototype._createMenuEntry = function(definition, element, action) {\n  var replaceElement = this._drdReplace.replaceElement;\n  var translate = this._translate;\n\n  var replaceAction = function() {\n    return replaceElement(element, definition.target);\n  };\n\n  action = action || replaceAction;\n\n  var menuEntry = {\n    label: translate(definition.label),\n    className: definition.className,\n    id: definition.actionName,\n    action: action\n  };\n\n  return menuEntry;\n};\n\nReplaceMenuProvider.prototype.getHeaderEntries = function(element) {\n  return [];\n};\n"],"mappings":"AAAA,SACEA,kBAAkB,EAClBC,EAAE,QACG,kCAAkC;AAEzC,SACEC,OAAO,EACPC,MAAM,QACD,UAAU;AAEjB,OAAOC,cAAc,MAAM,2BAA2B;;AAGtD;AACA;AACA;AACA,eAAe,SAASC,mBAAmBA,CACvCC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,EAC3BC,UAAU,EAAEC,KAAK,EAAEC,SAAS,EAAE;EAEhC,IAAI,CAACC,UAAU,GAAGN,SAAS;EAC3B,IAAI,CAACO,SAAS,GAAGN,QAAQ;EACzB,IAAI,CAACO,OAAO,GAAGN,MAAM;EACrB,IAAI,CAACO,WAAW,GAAGN,UAAU;EAC7B,IAAI,CAACO,MAAM,GAAGN,KAAK;EACnB,IAAI,CAACO,UAAU,GAAGN,SAAS;EAE3B,IAAI,CAACO,QAAQ,CAAC,CAAC;AACjB;AAEAb,mBAAmB,CAACc,OAAO,GAAG,CAC5B,WAAW,EACX,UAAU,EACV,QAAQ,EACR,YAAY,EACZ,OAAO,EACP,WAAW,CACZ;;AAGD;AACA;AACA;AACAd,mBAAmB,CAACe,SAAS,CAACF,QAAQ,GAAG,YAAW;EAClD,IAAI,CAACN,UAAU,CAACS,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC;AACvD,CAAC;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACAhB,mBAAmB,CAACe,SAAS,CAACE,UAAU,GAAG,UAASC,OAAO,EAAE;EAE3D,IAAIC,cAAc,GAAGD,OAAO,CAACC,cAAc;EAE3C,IAAId,KAAK,GAAG,IAAI,CAACM,MAAM;IACnBS,OAAO;IACPC,eAAe;EAEnB,IAAI,CAAChB,KAAK,CAACiB,OAAO,CAAC,eAAe,EAAE;IAAEJ,OAAO,EAAEA;EAAQ,CAAC,CAAC,EAAE;IACzD,OAAO,EAAE;EACX;EAEA,IAAItB,EAAE,CAACuB,cAAc,EAAE,cAAc,CAAC,EAAE;IACtCE,eAAe,GAAG1B,kBAAkB,CAACwB,cAAc,CAAC;IAEpDC,OAAO,GAAGtB,MAAM,CAACC,cAAc,CAACwB,QAAQ,EAAE,UAASC,MAAM,EAAE;MACzD,IAAIC,QAAQ,GACVD,MAAM,CAACE,UAAU,KAAK,6BAA6B,IACnDL,eACD;MACD,IAAIM,QAAQ,GACVH,MAAM,CAACE,UAAU,KAAK,6BAA6B,IACnD,CAAC9B,EAAE,CAACyB,eAAe,EAAE,mBAAmB,CACzC;MACD,IAAIO,MAAM,GACRJ,MAAM,CAACE,UAAU,KAAK,iCAAiC,IACvD,CAAC9B,EAAE,CAACyB,eAAe,EAAE,uBAAuB,CAC7C;MAED,OAAOI,QAAQ,IAAIE,QAAQ,IAAIC,MAAM;IACvC,CAAC,CAAC;IAEF,OAAO,IAAI,CAACC,cAAc,CAACX,OAAO,EAAEE,OAAO,CAAC;EAC9C;EAEA,IAAIxB,EAAE,CAACuB,cAAc,EAAE,4BAA4B,CAAC,EAAE;IACpDE,eAAe,GAAG1B,kBAAkB,CAACwB,cAAc,CAAC;IAEpDC,OAAO,GAAGtB,MAAM,CAACC,cAAc,CAAC+B,GAAG,EAAE,UAASN,MAAM,EAAE;MACpD,IAAIC,QAAQ,GACVD,MAAM,CAACE,UAAU,KAAK,oBAAoB,IAC1CL,eACD;MACD,IAAIM,QAAQ,GACVH,MAAM,CAACE,UAAU,KAAK,6BAA6B,IACnD,CAAC9B,EAAE,CAACyB,eAAe,EAAE,mBAAmB,CACzC;MACD,IAAIO,MAAM,GACRJ,MAAM,CAACE,UAAU,KAAK,iCAAiC,IACvD,CAAC9B,EAAE,CAACyB,eAAe,EAAE,uBAAuB,CAC7C;MAED,OAAOI,QAAQ,IAAIE,QAAQ,IAAIC,MAAM;IACvC,CAAC,CAAC;IAEF,OAAO,IAAI,CAACC,cAAc,CAACX,OAAO,EAAEE,OAAO,CAAC;EAC9C;EAEA,OAAO,EAAE;AACX,CAAC;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACApB,mBAAmB,CAACe,SAAS,CAACc,cAAc,GAAG,UAASX,OAAO,EAAEnB,cAAc,EAAE;EAC/E,IAAIgC,WAAW,GAAG,EAAE;EAEpB,IAAIC,IAAI,GAAG,IAAI;EAEfnC,OAAO,CAACE,cAAc,EAAE,UAASkC,UAAU,EAAE;IAC3C,IAAIC,KAAK,GAAGF,IAAI,CAACG,gBAAgB,CAACF,UAAU,EAAEf,OAAO,CAAC;IAEtDa,WAAW,CAACK,IAAI,CAACF,KAAK,CAAC;EACzB,CAAC,CAAC;EAEF,OAAOH,WAAW;AACpB,CAAC;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA/B,mBAAmB,CAACe,SAAS,CAACoB,gBAAgB,GAAG,UAASF,UAAU,EAAEf,OAAO,EAAEmB,MAAM,EAAE;EACrF,IAAIC,cAAc,GAAG,IAAI,CAAC5B,WAAW,CAAC4B,cAAc;EACpD,IAAIhC,SAAS,GAAG,IAAI,CAACM,UAAU;EAE/B,IAAI2B,aAAa,GAAG,SAAAA,CAAA,EAAW;IAC7B,OAAOD,cAAc,CAACpB,OAAO,EAAEe,UAAU,CAACO,MAAM,CAAC;EACnD,CAAC;EAEDH,MAAM,GAAGA,MAAM,IAAIE,aAAa;EAEhC,IAAIE,SAAS,GAAG;IACdC,KAAK,EAAEpC,SAAS,CAAC2B,UAAU,CAACS,KAAK,CAAC;IAClCC,SAAS,EAAEV,UAAU,CAACU,SAAS;IAC/BC,EAAE,EAAEX,UAAU,CAACP,UAAU;IACzBW,MAAM,EAAEA;EACV,CAAC;EAED,OAAOI,SAAS;AAClB,CAAC;AAEDzC,mBAAmB,CAACe,SAAS,CAAC8B,gBAAgB,GAAG,UAAS3B,OAAO,EAAE;EACjE,OAAO,EAAE;AACX,CAAC","ignoreList":[]}