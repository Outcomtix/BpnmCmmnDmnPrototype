{"version":3,"file":"DrillDown.js","names":["getBoxedExpression","getBusinessObject","is","classes","domClasses","delegate","domDelegate","PROVIDERS","className","matches","el","businessObject","decisionLogic","title","boxedExpression","DrillDown","constructor","injector","eventBus","overlays","config","translate","_injector","_eventBus","_overlays","_translate","_config","enabled","on","element","i","length","editable","addOverlay","node","_getOverlayNode","overlayId","add","position","top","left","html","bindEventListener","container","document","createElement","icon","appendChild","button","type","overlay","id","overlaysRoot","_overlayRoot","bind","triggerDefault","fire","drillDown","parent","get","view","getView","open","$inject"],"sources":["../../../src/features/drill-down/DrillDown.js"],"sourcesContent":["import {\n  getBoxedExpression,\n  getBusinessObject,\n  is\n} from 'dmn-js-shared/lib/util/ModelUtil';\n\nimport {\n  classes as domClasses,\n  delegate as domDelegate\n} from 'min-dom';\n\n\nvar PROVIDERS = [\n  {\n    className: 'dmn-icon-decision-table',\n    matches: function(el) {\n      var businessObject = getBusinessObject(el);\n\n      return (\n        is(businessObject, 'dmn:Decision') &&\n        is(businessObject.decisionLogic, 'dmn:DecisionTable')\n      );\n    },\n    title: 'Open decision table'\n  },\n  {\n    className: 'dmn-icon-literal-expression',\n    matches: function(el) {\n      var boxedExpression = getBoxedExpression(el);\n\n      return is(boxedExpression, 'dmn:LiteralExpression');\n    },\n    title: 'Open literal expression'\n  }\n];\n\n\n/**\n * Displays overlays that can be clicked in order to drill\n * down into a DMN element.\n */\nexport default class DrillDown {\n\n  constructor(injector, eventBus, overlays, config, translate) {\n    this._injector = injector;\n    this._eventBus = eventBus;\n    this._overlays = overlays;\n    this._translate = translate;\n\n    this._config = config || { enabled: true };\n\n    eventBus.on([ 'shape.added' ], ({ element }) => {\n\n      for (let i = 0; i < PROVIDERS.length; i++) {\n\n        const { matches, className, title } = PROVIDERS[i];\n\n        var editable = matches && matches(element);\n\n        if (editable) {\n          this.addOverlay(element, className, title);\n        }\n      }\n    });\n  }\n\n  /**\n   * Add overlay to an element that enables drill down.\n   *\n   * @param {Object} element Element to add overlay to.\n   * @param {string} className\n   *        CSS class that will be added to overlay in order to display icon.\n   * @param {string} title added to the button\n   */\n  addOverlay(element, className, title) {\n    const enabled = this._config.enabled !== false;\n\n    const node = this._getOverlayNode(className, title, enabled);\n\n    const overlayId = this._overlays.add(element, {\n      position: {\n        top: 2,\n        left: 2\n      },\n      html: node\n    });\n\n    // TODO(nikku): can we remove renamed to drillDown.enabled\n    if (enabled) {\n      domClasses(node).add('interactive');\n      this.bindEventListener(element, node, overlayId);\n    }\n  }\n\n  _getOverlayNode(className, title, enabled) {\n    const container = document.createElement('div');\n    container.className = 'drill-down-overlay';\n\n    if (!enabled) {\n      const icon = document.createElement('span');\n      icon.className = className;\n      container.appendChild(icon);\n\n      return container;\n    }\n\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = className;\n    button.title = this._translate(title);\n\n    container.appendChild(button);\n\n    return container;\n  }\n\n  /**\n   * @param {Object} element\n   * @param {Object} overlay\n   * @param {string} id\n   */\n  bindEventListener(element, overlay, id) {\n    const overlays = this._overlays,\n          eventBus = this._eventBus;\n\n    const overlaysRoot = overlays._overlayRoot;\n\n    domDelegate.bind(overlaysRoot, '[data-overlay-id=\"' + id + '\"]', 'click', () => {\n\n      const triggerDefault = eventBus.fire('drillDown.click', {\n        element\n      });\n\n      if (triggerDefault === false) {\n        return;\n      }\n\n      this.drillDown(element);\n    });\n  }\n\n\n  /**\n   * Drill down into the specific element.\n   *\n   * @param  {djs.model.Base} element\n   *\n   * @return {boolean} whether drill down was executed\n   */\n  drillDown(element) {\n\n    const parent = this._injector.get('_parent', false);\n\n    // no parent; skip drill down\n    if (!parent) {\n      return false;\n    }\n\n    const view = parent.getView(element.businessObject);\n\n    // no view to drill down to\n    if (!view) {\n      return false;\n    }\n\n    parent.open(view);\n\n    return true;\n  }\n\n}\n\nDrillDown.$inject = [\n  'injector',\n  'eventBus',\n  'overlays',\n  'config.drillDown',\n  'translate'\n];"],"mappings":"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","ignoreList":[]}