{"version":3,"file":"DrdReplace.js","names":["is","DrdReplace","drdFactory","replace","selection","modeling","replaceElement","element","target","hints","type","oldBusinessObject","businessObject","newBusinessObject","create","newElement","width","height","name","table","$parent","output","typeRef","input","inputExpression","setBoxedExpression","expression","literalExpression","variable","$inject","bo","decisionLogic","encapsulatedLogic","body"],"sources":["../../../src/features/replace/DrdReplace.js"],"sourcesContent":["import { is } from 'dmn-js-shared/lib/util/ModelUtil';\n\n/**\n * This module takes care of replacing DRD elements\n */\nexport default function DrdReplace(drdFactory, replace, selection, modeling) {\n\n  /**\n   * Prepares a new business object for the replacement element\n   * and triggers the replace operation.\n   *\n   * @param  {djs.model.Base} element\n   * @param  {Object} target\n   * @param  {Object} [hints]\n   *\n   * @return {djs.model.Base} the newly created element\n   */\n  function replaceElement(element, target, hints) {\n\n    hints = hints || {};\n\n    var type = target.type,\n        oldBusinessObject = element.businessObject;\n\n    var newBusinessObject = drdFactory.create(type);\n\n    var newElement = {\n      type: type,\n      businessObject: newBusinessObject\n    };\n\n    newElement.width = element.width;\n    newElement.height = element.height;\n\n    newBusinessObject.name = oldBusinessObject.name;\n\n    if (target.table) {\n      var table = drdFactory.create('dmn:DecisionTable');\n      table.$parent = newBusinessObject;\n\n      var output = drdFactory.create('dmn:OutputClause');\n      output.typeRef = 'string';\n      output.$parent = table;\n      table.output = [ output ];\n\n      var input = drdFactory.create('dmn:InputClause');\n      input.$parent = table;\n\n      var inputExpression = drdFactory.create('dmn:LiteralExpression', {\n        typeRef: 'string'\n      });\n\n      input.inputExpression = inputExpression;\n      inputExpression.$parent = input;\n\n      table.input = [ input ];\n\n      setBoxedExpression(newBusinessObject, table, drdFactory);\n    }\n\n    if (target.expression) {\n\n      // variable set to element name\n      var literalExpression = drdFactory.create('dmn:LiteralExpression'),\n          variable = drdFactory.create('dmn:InformationItem',\n            { name: oldBusinessObject.name });\n\n      setBoxedExpression(newBusinessObject, literalExpression, drdFactory, variable);\n    }\n\n    return replace.replaceElement(element, newElement, hints);\n  }\n\n  this.replaceElement = replaceElement;\n}\n\nDrdReplace.$inject = [\n  'drdFactory',\n  'replace',\n  'selection',\n  'modeling'\n];\n\n// helper //////////////////////////////////////////////////////////////\nfunction setBoxedExpression(bo, expression, drdFactory, variable) {\n  if (is(bo, 'dmn:Decision')) {\n    bo.decisionLogic = expression;\n    expression.$parent = bo;\n  } else if (is(bo, 'dmn:BusinessKnowledgeModel')) {\n    var encapsulatedLogic = drdFactory.create('dmn:FunctionDefinition', {\n      body: expression });\n\n    bo.encapsulatedLogic = encapsulatedLogic;\n    encapsulatedLogic.$parent = bo;\n    expression.$parent = encapsulatedLogic;\n  }\n\n  if (variable) {\n    bo.variable = variable;\n    variable.$parent = bo;\n  }\n}"],"mappings":"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","ignoreList":[]}