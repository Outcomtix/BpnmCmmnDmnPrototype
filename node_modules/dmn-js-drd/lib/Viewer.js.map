{"version":3,"file":"Viewer.js","names":["domify","query","domQuery","remove","domRemove","Diagram","inherits","importDRD","innerSVG","wrapForCompatibility","addProjectLogo","Viewer","options","_container","_createContainer","_init","prototype","saveSVG","self","Promise","resolve","canvas","get","contentNode","getActiveLayer","defsNode","_svg","contents","defs","outerHTML","bbox","getBBox","svg","width","height","x","y","getModules","_modules","destroy","call","on","event","priority","callback","target","off","container","additionalModules","additionalOptions","baseModules","modules","staticModules","drd","diagramOptions","attachTo","_emit","type","fire","open","definitions","reject","err","_definitions","clear","warnings","e","parentNode","Error","detach","appendChild","resized","removeChild","CoreModule","TranslateModule","SelectionModule","OverlaysModule","DefinitionPropertiesModule","DrillDownModule"],"sources":["../src/Viewer.js"],"sourcesContent":["/**\n * The code in the <project-logo></project-logo> area\n * must not be changed.\n *\n * @see http://bpmn.io/license for more information.\n */\n\nimport {\n  domify,\n  query as domQuery,\n  remove as domRemove\n} from 'min-dom';\n\nimport Diagram from 'diagram-js';\n\nimport inherits from 'inherits-browser';\n\nimport {\n  importDRD\n} from './import/Importer';\n\nimport {\n  innerSVG\n} from 'tiny-svg';\n\nimport {\n  wrapForCompatibility\n} from 'dmn-js-shared/lib/util/CompatibilityUtils';\n\nimport {\n  addProjectLogo\n} from 'dmn-js-shared/lib/util/PoweredByUtil';\n\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenResult} OpenResult\n */\n\n/**\n * @typedef {import('dmn-js-shared/lib/base/View).OpenError} OpenError\n */\n\n\n/**\n * A viewer for DMN diagrams.\n *\n * Have a look at {@link NavigatedViewer} or {@link Modeler} for bundles that include\n * additional features.\n *\n *\n * ## Extending the Viewer\n *\n * In order to extend the viewer pass extension modules to bootstrap via the\n * `additionalModules` option. An extension module is an object that exposes\n * named services.\n *\n * The following example depicts the integration of a simple\n * logging component that integrates with interaction events:\n *\n *\n * ```javascript\n *\n * // logging component\n * function InteractionLogger(eventBus) {\n *   eventBus.on('element.hover', function(event) {\n *     console.log()\n *   })\n * }\n *\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\n *\n * // extension module\n * var extensionModule = {\n *   __init__: [ 'interactionLogger' ],\n *   interactionLogger: [ 'type', InteractionLogger ]\n * };\n *\n * // extend the viewer\n * var drdViewer = new Viewer({ additionalModules: [ extensionModule ] });\n * drdViewer.importXML(...);\n * ```\n *\n * @param {Object} options configuration options to pass to the viewer\n * @param {DOMElement} [options.container]\n *        the container to render the viewer in, defaults to body\n * @param {Array<didi.Module>} [options.modules]\n *        a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules]\n *        a list of modules to use with the default modules\n */\nexport default function Viewer(options) {\n\n  this._container = this._createContainer();\n\n  /* <project-logo> */\n\n  addProjectLogo(this._container);\n\n  /* </project-logo> */\n\n  this._init(this._container, options);\n}\n\ninherits(Viewer, Diagram);\n\n/**\n * The saveSVG result.\n *\n * @typedef {Object} SaveSVGResult\n *\n * @property {string} svg\n */\n\n/**\n * Export the currently displayed DMN diagram as\n * an SVG image.\n *\n * @param {Object} [options]\n *\n * @return {Promise<SaveSVGResult>}\n */\nViewer.prototype.saveSVG = wrapForCompatibility(function(options) {\n  var self = this;\n\n  return new Promise(function(resolve) {\n\n    var canvas = self.get('canvas');\n\n    var contentNode = canvas.getActiveLayer(),\n        defsNode = domQuery('defs', canvas._svg);\n\n    var contents = innerSVG(contentNode),\n        defs = (defsNode && defsNode.outerHTML) || '';\n\n    var bbox = contentNode.getBBox();\n\n    var svg =\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n      '<!-- created with dmn-js / http://bpmn.io -->\\n' +\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n           'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\n           'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\n        defs + contents +\n      '</svg>';\n\n    resolve({ svg });\n  });\n});\n\nViewer.prototype.getModules = function() {\n  return this._modules;\n};\n\n/**\n * Destroy the viewer instance and remove all its\n * remainders from the document tree.\n */\nViewer.prototype.destroy = function() {\n\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * Register an event listener\n *\n * Remove a previously added listener via {@link #off(event, callback)}.\n *\n * @param {string} event\n * @param {number} [priority]\n * @param {Function} callback\n * @param {Object} [that]\n */\nViewer.prototype.on = function(event, priority, callback, target) {\n  return this.get('eventBus').on(event, priority, callback, target);\n};\n\n/**\n * De-register an event listener\n *\n * @param {string} event\n * @param {Function} callback\n */\nViewer.prototype.off = function(event, callback) {\n  this.get('eventBus').off(event, callback);\n};\n\n\nViewer.prototype._init = function(container, options) {\n\n  var {\n    additionalModules,\n    canvas,\n    ...additionalOptions\n  } = options;\n\n  var baseModules = options.modules || this.getModules(),\n      staticModules = [\n        {\n          drd: [ 'value', this ]\n        }\n      ];\n\n  var modules = [\n    ...staticModules,\n    ...baseModules,\n    ...(additionalModules || [])\n  ];\n\n  var diagramOptions = {\n    ...additionalOptions,\n    canvas: {\n      ...canvas,\n      container\n    },\n    modules\n  };\n\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {string} type\n * @param  {Object} event\n *\n * @return {Object} event processing result (if any)\n */\nViewer.prototype._emit = function(type, event) {\n  return this.get('eventBus').fire(type, event);\n};\n\nViewer.prototype._createContainer = function() {\n  return domify(\n    '<div class=\"dmn-drd-container\"></div>'\n  );\n};\n\n/**\n * Open diagram element.\n *\n * @param  {ModdleElement} definitions\n * @returns {Promise} Resolves with {OpenResult} when successful\n * or rejects with {OpenError}\n */\nViewer.prototype.open = function(definitions) {\n  var self = this;\n\n  return new Promise((resolve, reject) => {\n    var err;\n\n    // use try/catch to not swallow synchronous exceptions\n    // that may be raised during model parsing\n    try {\n\n      if (self._definitions) {\n\n        // clear existing rendered diagram\n        self.clear();\n      }\n\n      // update definitions\n      self._definitions = definitions;\n\n      // perform graphical import\n      return importDRD(self, definitions, function(err, warnings) {\n        if (err) {\n          err.warnings = warnings || [];\n          reject(err);\n        } else {\n          resolve({ warnings: warnings || [] });\n        }\n      });\n    } catch (e) {\n      err = e;\n    }\n\n    if (err) {\n      err.warnings = err.warnings || [];\n      reject(err);\n    } else {\n      resolve({ warnings: [] });\n    }\n  });\n};\n\n/**\n * Attach viewer to given parent node.\n *\n * @param  {Element} parentNode\n */\nViewer.prototype.attachTo = function(parentNode) {\n\n  if (!parentNode) {\n    throw new Error('parentNode required');\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  var container = this._container;\n\n  parentNode.appendChild(container);\n\n  this._emit('attach', {});\n\n  this.get('canvas').resized();\n};\n\n/**\n * Detach viewer from parent node, if attached.\n */\nViewer.prototype.detach = function() {\n\n  var container = this._container,\n      parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  this._emit('detach', {});\n\n  parentNode.removeChild(container);\n};\n\nimport CoreModule from './core';\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\nimport SelectionModule from 'diagram-js/lib/features/selection';\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\nimport DefinitionPropertiesModule from './features/definition-properties/viewer';\nimport DrillDownModule from './features/drill-down';\n\nViewer.prototype._modules = [\n  CoreModule,\n  TranslateModule,\n  SelectionModule,\n  OverlaysModule,\n  DefinitionPropertiesModule,\n  DrillDownModule\n];\n\n"],"mappings":"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","ignoreList":[]}